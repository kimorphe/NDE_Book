%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setcounter{section}{3}
\section{問題設定}
物体中に存在するき裂や空洞などの形状を，観測で得た超音波エコー波形から再構成する
問題を考える．形状再構成を行った結果は，画像として表示することを前提とする
ため，以下では形状再構成を行うことと，画像化を同じ意味で用いる．
本節では，開講合成法を中心に，画像合成の原理をできるだけ簡単な状況設定で導入及び
考察する．そのために，図\ref{fig:XXX_arrayM}のような，無限領域内部に存在する
欠陥の画像化(形状再構成)について議論する．媒体は均質な等方線形弾性体で，
超音波をスカラー波とみなす．以下，欠陥が占める領域を$D$，その境界を$\partial D$と表し，
観測波形から$D$や$\partial D$を推定することが画像化の目的となる．\\

スカラー波の送受信は，指定された観測面内にとった$M$個の点:
\begin{equation}
	{\cal M} =\left\{ 
		\fat{y}_1, \fat{y}_2, \cdots \fat{y}_M
	\right\}
	\label{eqn:XXX_00}
\end{equation}
のいずれか，あるいは全ての位置に置かれた理想的な送受信子で行う．
ここで，"理想的"とは次のことを意味する．
\begin{itemize}
\item
送受信子の大きさは波長に比べて小さく点波源，あるいは，点レシーバーとみなすことができる．
\item
送受信子の応答特性が既知，すなわち，指向性や周波数応答特性が知られている．
\item
送受信子は入射波や散乱波動場を乱さない．すなわち，媒体中に発生する
波動場は送受信子と干渉せず，同一点で送信と受信を行うことも可能とする．
\end{itemize}
いま, 位置$\fat{y}_i$にある送信子から入射波を励起し，位置$\fat{y}_j$にある受信子で
波動場を観測したとする．このとき得られるAスキャン波形を$a_{ij}(t)$と表す．
超音波イメージングには，通常，多点計測で得られた複数のAスキャン波形を用いる．
そこで，$\cal M$上の送受信子で得られる波形データセットの全体や一部を参照する
方法について定めておく．
はじめに，全ての可能な送受信位置の組み合わせで得られる波形データを
\begin{equation}
	{\cal D} = \left\{ a_{ij}(t) \left| (\fat{y}_i,\fat{y}_j)  \in {\cal M}\times {\cal M} \right.\right\}
	\label{eqn:XXX_full_mat}
\end{equation}
と表すことにする．${\cal D}(M^2)$を得るためにアレイ探触子を用いる場合，
送受信チャンネルを順次切り替えながら，全ての素子の組で波形収録を行うことになる．
このような観測方式はフルマトリクスキャプチャリングと呼ばれ，$\cal M$が占める範囲は
アレイ探触子の物理的な開口に相当する．一方，一つの送信子と受信子を用いて${\cal D}$
を得るには，送受信子位置を順次移動させながら計測を繰り返す．
この場合，$\cal M$は一連の計測でカバーされる開口(合成開口)を表し，
このような走査方式は機械的走査と呼ばれる．物理的な波形収録方法がいずれであれ，
結果として同じ波形データセットが与えられるならば，画像化の結果に違いは生じない．
このことから，以下では物理的観測方法や，アレイセンサーの開口と合成開口の区別を
断ることはしない．

$\cal M$上で多点計測を行う場合，必ずしも全ての可能な位置の組み合わせで波形収録を
行うとは限らない．その場合，得られる波形データの集合は一般に${\cal D}({\cal M}^2)$の一部である．そこで，
送受信位置の組み合わせ，すなわち観測点配置を
\begin{equation}
	{\cal A}\subset {\cal M}\times {\cal M}
	\label{eqn:XXX_apt}
\end{equation}
とし，${\cal A}$上で得られる波形データセットを
\begin{equation}
	{\cal D}\left({\cal A} \right) 
	= 
	\left\{ a_{ij}(t) \left| (\fat{y}_i,\fat{y}_j)  \in {\cal A}\right.\right\}
	\label{eqn:XXX_DA}
\end{equation}
と表す．例えば，一つの探触子で送受信を行うパルスエコー法によって$\cal M$を走査して
得られるデータは
\begin{equation}
	{\cal A}=\left\{ 
	(\fat{y}_i,\fat{y}_i)
	\left|
		i=1,\cdots M
	\right.
	\right\}
	\label{eqn:XXX_pecho}
\end{equation}
としたときの${\cal D}({\cal A})$である．

以下では，観測点配置$\cal A$を指定したときに与えられるデータ${\cal D}({\cal A})$から，
散乱体$D$の形状を再構成して画像化する方法について考える．その際，画像化を行う領域を$A$，
画像化点を$\fat{x}$とし，$\fat{x}$における画素値を$I(\fat{x})$と表す．
画像化関数$I(x)$は領域$A$で定義されるスカラー関数で，その値が取りうる範囲や意味は
画像化手法によって異なる．
\begin{figure}[h]
	\begin{center}
	\includegraphics[width=0.6\linewidth]{Figs/measurement.pdf} 
	\end{center}
	\caption{送受信アレイ$\cal M$，散乱体$D$，および画像化領域$A$.} 
	\label{fig:XXX_arrayM}
\end{figure}
%
\section{開口合成法}
\subsection{再構成式}
開口合成法では次のような波形の重ね合わせで欠陥の画像を合成する．
\begin{equation}
	I(\fat{x})=\sum_{\cal D}a_{ij}(t_{ij}(\fat{x}))w_{ij}(\fat{x})
	\label{eqn:XXX_saft}
\end{equation}
ここで，$\sum_{\cal D}(\cdot)$は，データ$\cal D$に関する和を表し，
正確には
\begin{equation}
	\sum_{\cal D} 
	(\cdot)
	=
	\sum_{\cal D(A)}
	(\cdot)
	=
	\sum_{(\fat{y}_i,\fat{y}_j)\in{\cal A}}
	(\cdot)
	\label{eqn:XXX_sum_D}
\end{equation}
を意味する．従って，${\cal A}= {\cal M}\times{\cal M}$ならばインデックス$i,j$に関する二重和を，
式(\ref{eqn:XXX_pecho})のような観測点配置であれば$i(=j)$に関する和を表す．
式(\ref{eqn:XXX_saft})におけるサンプリング時間$t_{ij}$は，送信点$\fat{y}_i$から入射された波が，
画像化点$\fat{x}$を経て観測点$\fat{y}_j$に至るまでに要する時間を表す．
高周波近似が成り立つと仮定すれば，均質媒体における波動伝播経路を直線と考えて良い．
そこで，媒体の位相速度を$c$とすれば，$t_{ij}(\fat{x})$を次のように書くことができる．
\begin{equation}
	t_{ij}(\fat{x})=\frac{r_i(\fat{x})+r_j(\fat{x})}{c}, \ \ r_i:=\left| \fat{x} -\fat{y}_i\right|
	\label{eqn:XXX_tij}
\end{equation}
最後に，式(\ref{eqn:XXX_saft})の$w_{ij}(\fat{x})$は，Aスコープ波形を重ね合わせる際の重みを表す．
例えば，送受信センサーの指向性や感度，波動場の材料減衰や幾何減衰を補正するために調整できる項である．

式(\ref{eqn:XXX_saft})は発見的に与えられたもので，この段階では画像$I(\fat{x})$が何を表し，
どのような原理に基づいて像合成が行われるか明らかでない．
そこで，以下において，$I(\fat{x})$が点散乱体の強度とみなせることを述べ，
次に，開口合成法がどのように機能するかを簡単な数値実験を通して調べる．
%また，どのような計測条件が画像化上有利であるかも，
%数値実験を通じてかなりの程度調べられる．さらに，開口合成法は，画像化関数のアドホックな改善や拡張と，
%画像化アルゴリズムの実装が極めて簡単であることが利点である．
%例えば，送受信センサーの指向性や距離減衰，入射波や散乱波の反射やモード変換を計測条件に応じて
%考慮することも(そのやり方が妥当かどうかの検証はさておき)簡単である．
さらに，次節と次々節では，随伴方程式法と線形化逆散乱解析による画像化方法と開講合成法
が関係付けられることを見ることにより，開口合成法の理論的な基礎を与える．
%なお，開口合成法の再構成式(\ref{eqn:XXX_saft})は，後に述べるように線形化逆散乱解析法や
%随伴方程式法の結果を単純化することで導出できることをみる．
%開口合成法の画像化関数$I(\fat{x})$の意味はその結果として明らかになる．
\subsection{基本的な考え方}
大きさをもった散乱体$D$を，点散乱体の集まりとみなして散乱問題と画像化問題を
を考えてみる．例えば，き裂や空洞，剛体介在物では領域の表面で散乱がおきるため，
散乱体をその境界$\partial D$上に稠密に配置された点散乱体群とみなす．一方，
介在物の場合，領域内部に入射波の一部が透過するため，$D$全体に渡って点散乱体が
配置されたモデルを考える．以下に述べるように，開口合成法はこれら点散乱体の
位置と強度を画像化する方法と解釈することができる．
\begin{figure}[h]
	\begin{center}
	\includegraphics[width=0.5\linewidth]{Figs/cloud.pdf} 
	\end{center}
	\caption{点散乱体群による散乱体の表現(イメージ).} 
	\label{fig:XXX_cloud}
\end{figure}
ここで，点散乱体とは，大きさの無視できる理想化された散乱体を意味し，入射波振幅
に比例した強度の点源として振る舞うものである．その比例係数を$s$とし，これを
散乱強度と呼べば，位置$\fat{z}$にある点散乱体は，入射波$u^{in}(\fat{x},t)$に
よって励起される点源項としして扱うことができる．スカラー波動場の場合，それは
支配波動方程式における次のようなソース項として表される．
\begin{equation}
	4\pi s\delta (\fat{x}-\fat{z})u^{in}(\fat{z},t)
	\label{eqn:XXX_psct}
\end{equation}
ただし，式(\ref{eqn:XXX_psct})において$s$は定数としており，これは散乱による
位相遅れや波形変化が無いことを意味している．ただし，入射波と散乱波で位相が
逆転することがある場合は，散乱強度$s$は負の値となることは許容する必要がある．
次に，観測波形と散乱強度を結びつけるために，全波動場を入射場と散乱場の
和として次のように表す．
\begin{equation}
	u(\fat{x},t)=u^{in}(\fat{x},t)+u^{sc}(\fat{x},t)
	\label{eqn:XXX_utot}
\end{equation}
また，全空間のグリーン関数を$G(\fat{x},\fat{y},t)$とすれば，
点散乱体群からの散乱波$u^{sc}(\fat{x},t)$は次のように表すことができる．
\begin{equation}
	u^{sc}(\fat{x},t)=\sum_k s_k G(\fat{x},\fat{z}_k,t)*u^{in}(\fat{z}_k,t)
	\label{eqn:XXX_usc_G}
\end{equation}
ただし，$*$は時間に関する畳み込み積を，$\fat{z}_k$と$s_k$は，
第$k$番目の点散乱体の位置と強度をそれぞれ表す．さらに，入射波は
位置$\fat{y}_i(\in {\cal M})$の点源で励起されるとしているため，
式(\ref{eqn:XXX_usc_G})において$u^{in}(\fat{x},t)=G(\fat{x},\fat{y}_i,t)$とすれば，
次の関係が得られる．
\begin{equation}
	u^{sc}(\fat{x},t;\fat{y}_{i})=\sum_k s_k G(\fat{x},\fat{z}_k,t)*G(\fat{z}_k,\fat{y}_i,t)
	\label{eqn:XXX_usc_GG}
\end{equation}
なお，式(\ref{eqn:XXX_usc_GG})の左辺では，セミコロンの後に$\fat{y}_i$を加え，
位置$\fat{y}_i$からの入射波に起因した散乱波であることを明示するようにしている．
観測で得らるAスキャン波形$a_{ij}(t)$は，$\fat{y}_j$における散乱場だから
\begin{equation}
	a_{ij}(t)
	=u^{sc}(\fat{y}_j,t;\fat{y}_i)
	=\sum_k s_k G(\fat{y}_j,\fat{z}_k,t)*G(\fat{z}_k,\fat{y}_i,t)
	\label{eqn:XXX_aij_GG}
\end{equation}
となる．これをより具体的な表現にするために，3次元スカラー波のグリーン関数:
\begin{equation}
	G(\fat{x},\fat{y},t)=
	\frac{\delta\left(t-\frac{r}{c}\right)}{r}, 
	\ \ (r=\left| \fat{x}-\fat{y}\right|)
	\label{eqn:}
\end{equation}
を用いれば，$a_{ij}(t)$は次のようになる．
\begin{eqnarray}
	a_{ij}(t)
	&=&
	\sum_{k}
	\frac{ s(\fat{z}_k) }{ r_i(k)r_j(k) }
	\delta\left(t-\frac{r_i(k)}{c}\right) * \delta\left( t-\frac{r_j(k)}{c}\right)\\
	\label{eqn:}
	&=&
	\sum_k
	\frac{ s(\fat{z}_k) }{ r_i(k)r_j(k) }
	\delta\left(t-\frac{r_i(k)+r_j(k)}{c}\right) 
	\label{eqn:XXX_aijt}
\end{eqnarray}
ただし，$r_i(k)=\left| \fat{y}_i-\fat{z}_k\right|$とした．

式(\ref{eqn:XXX_aijt})を式(\ref{eqn:XXX_saft})を用いれば，開口合成法における画像化関数を
次のように表すことができる．
\begin{eqnarray}
	I(\fat{x})
	&=&
	\sum_{\cal D}
	\sum_{k}
	\frac{ s(\fat{z}_k)}{r_i(k)r_j(k)}
	\delta\left(t_{ij}(\fat{x})-\frac{r_i(k)+r_j(k)}{c}\right)  w_{ij}
	\\
	&=&
	\sum_{\cal D} \sum_{k}
	\frac{cw_{ij}}{r_i(k)r_j(k)} s(\fat{z}_k)
	\delta\left(r_i(\fat{x})+r_j(\fat{x})-r_i(k)-r_j(k)\right) 
	\label{eqn:XXX_I_model}
\end{eqnarray}
式(\ref{eqn:XXX_I_model})の右辺は，Diracのデルタ関数を使って書かれているため
その値を評価することはできない．そこで，デルタ関数$\delta(s)$を，
分散$\sigma^2$の正規分布:
\begin{equation}
	\delta_\sigma (s) = \frac{1}{ \sqrt{2\pi}\sigma } \exp\left( -\frac{s^2}{2\sigma^2}\right)
	\label{eqn:Gauss}
\end{equation}
で近似する．$\delta_\sigma(s)$は通常の意味での関数であり数値的な評価は容易である．
また，$\sigma\rightarrow 0$の極限においてデルタ関数を与え，パラメータ$\sigma$を小さく
することで必要なだけ近似精度を上げることができる．
最後に，データ$\cal D(A)$に含まれる波形数を$|{\cal A}|$として，
\begin{equation}
	w_{ij}^*
	=
	\sqrt{2\pi}\sigma
	\frac{r_{i}(\fat{x})r_j(\fat{x})}{c\left| {\cal A}\right|}
	\label{eqn:XXX_wij_model}
\end{equation}
とし，これを開口合成法の重みとして用いれば，画像化関数が$\sigma$に応じた精度で
\begin{equation}
	I(\fat{x})
		\simeq 
	I_\sigma(\fat{x})
		:=
	\sum_{\cal D} \sum_{k}
	\frac{w_{ij}^*s_k}{r_i(k)r_j(k)} 
	\delta_\sigma\left(r_i(\fat{x})+r_j(\fat{x})-r_i(k)-r_j(k)\right) 
	\label{eqn:XXX_saft_model}
\end{equation}
と近似できる．このようにして得られた$I_\sigma(\fat{x})$は散乱体位置$\fat{z}_k$において
\begin{equation}
	I_\sigma(\fat{z}_k)=s_k
	\label{eqn:}
\end{equation}
と散乱体強度に一致することが確かめられる．これは，開口合成法が点散乱体の
強度分布を推定する方法であることを示している．
ただし点散乱体の位置を推定できるような画像を得るためには，$\fat{x}\neq \fat{z}_k$
では$I_\sigma(\fat{x})$は$s_k$に比べて小さな値を取る必要がある．
そこで，$I_\sigma(\fat{x})$がどのような位置で大きな値をとるかを考えてみる．
このとき，$\sigma$は十分小さいとすれば，$\delta_\sigma(s)$は$|s|\rightarrow \infty$で
急速に減少する．このことから，
$\delta_\sigma\left(r_i(\fat{x})+r_j(\fat{x})-r_i(k)-r_j(k)\right)$が有意な値を取るのは
\begin{equation}
	r_i(\fat{x})+r_j(\fat{x})=r_i(k)+r_j(k)
	\label{eqn:XXX_cntr}
\end{equation}
となる$\fat{x}$のごく近傍に限られる．
式(\ref{eqn:XXX_cntr})は，$(i,j)$すなわち送受信点の組に対し，3次元問題では一つの曲面を，
2次元問題では曲線を定義する．これら，式(\ref{eqn:XXX_cntr})が定める曲線あるいは曲面を
$\Gamma_{ij}(\fat{z}_k)$とすれば，$I_\sigma(\fat{x})$が大きな値をとるためには，
画像化点$\fat{x}$が，多数の$\Gamma_{ij}(\fat{z}_k)$の共通部分に属する必要がある．
従って，$\cal A$が定める曲面群(曲線群):
\begin{equation}
	\left\{ \Gamma_{ij}(\fat{z})\left|  (i,j)\in {\cal A} ,\,\, \fat{z} \in A \right.\right\}
	\label{eqn:XXX_Crvs}
\end{equation}
が任意の$\fat{z}\in A$に対して，$\fat{x}=\fat{z}$以外の位置で共通部分を持たないようにすることができれば，
正確に点散乱体の位置と強度を推定できることが分かる．
$\cal A$をどのように選択すればこの条件が満足されるか，一般的な状況で調べることは難しい．
そこで，以下では簡単な数値実験を行い，送受信点配置$\cal A$に応じてどのような開口合成像が
得られるかを調べる．
$\Gamma_{ij}$は，$(\fat{y}_i,\fat{y}_j)$の送受信点で観測されるインパルス波形が，
開口合成法による画像化において投影される位置を表す．このことを踏まえ，以下では
$\Gamma_{ij}$をエコー投影曲面あるいはエコー投影曲線と呼ぶ．
$\Gamma_{ij}$は球(円)あるいはだ円体(だ円)になることが容易に示される．
\subsection{単一点散乱体の開口合成像}
大きさをもった散乱体を点散乱体群がどの程度よく近似できるかという問題はさておき，
少なくとも，単一の点散乱体の形状再構成は満足のいく精度でできることが期待される．
そこで，座標原点$\fat{o}$にある無指向性の単一点散乱体を，2次元開口合成法で画像化する
問題を考える．この場合，点散乱体を識別する番号は$k=1$のみだから，$k$に関する和をとる必要は無く，
散乱体位置$\fat{z}_k$や強度$s_k$のインデックス$k$を省略しても
混乱は無い．そこで，式(\ref{eqn:XXX_saft_model})を
\begin{equation}
	I_\sigma(\fat{x})
		=
	\sum_{\cal D} 
	\frac{w_{ij}^*s}{r_i(\fat{z})r_j(\fat{z})} 
	\delta_\sigma\left(r_i(\fat{x})+r_j(\fat{x})-r_i(\fat{z})-r_j(\fat{z})\right) 
	\label{eqn:XXX_saft_model_k1}
\end{equation}
と書き直す．式(\ref{eqn:XXX_saft_model_k1})の右辺は，$\fat{z}$や$s$を具体的に
与えれば実際に計算することができ，$I_\sigma(\fat{x})$の値は，エコー投影曲線
(\ref{eqn:XXX_Crvs})の配置によって概ね決定される．具体的には，多数の曲線が
交差する箇所で大きな値をとり，少数の曲線が通る，あるいは曲線が通らない箇所は小さな値になる．
従って，$\Gamma_{ij}(\fat{z}$の交差状況を見ることで，開口合成法がどのように像合成を
行うかかなりの程度理解できる．そこで，送受信点配置$\cal A$を与え，
簡単なケースで曲線群(\ref{eqn:XXX_Crvs})を描画してみる．
%なお，観測に用いる送受信子は無指向性かつ周波数帯域が十分広く，デルタ関数を含め
%任意の波形を正確に送受信できる理想化された観測条件を仮定する．
%このような単一点散乱体の開口合成結果を見ることで，開口合成法がどのように機能するかを理解することができる．
\subsubsection{送受信点が一つの場合}
はじめに一箇所で送受信を行った場合($M=1$)について考える．このとき，
\begin{equation}
	{\cal M} =\left\{ 
		\fat{y}_1
	\right\}
	\label{eqn:XXX_M1}
\end{equation}
で，自動的に${\cal A}={(\fat{y}_1,\fat{y}_1)}$となるので，考慮すべき
曲線は$\Gamma_{11}(\fat{z})$のみである．一般の$\Gamma_{ij}(\fat{z})$は
式(\ref{eqn:XXX_cntr})で表されるので，$\Gamma_{11}(\fat{z})$は
$i=j=1$として
\begin{equation}
	\Gamma_{11}(\fat{z}): 
	r_{1}(\fat{x})=r_{1}(\fat{z})=\left| \fat{y}_1-\fat{z} \right|
	\label{eqn:XXX_Gmm11}
\end{equation}
となる．これは中心$\fat{y}_1$，半径$r_1(\fat{z})$の円を表す．
この場合，$I_\sigma(\fat{x})$からは，円弧$\Gamma_{11}(\fat{z})$上
のいずれかの位置に散乱体が存在することまでが推定できる．
\subsubsection{送受信点が二つの場合}
次に2つの送受信位置をとり$M=2$とした場合，すなわち
\begin{equation}
	{\cal M} =\left\{ 
		\fat{y}_1, \fat{y}_2
	\right\}
	\label{eqn:XXX_M2}
\end{equation}
での画像化について考える．このとき，$\Gamma_{ij}=\Gamma_{ji}$だから，
曲線群(\ref{eqn:XXX_Crvs})は3つの要素を持つ．
\begin{equation}
	\left\{ \Gamma_{ij} \right\} = \left\{ \Gamma_{11},\Gamma_{22}, \Gamma_{12}=\Gamma_{21}\right\}
	\label{eqn:}
\end{equation}
このうち，$\Gamma_{ii}, (i=1,2)$は，中心$\fat{y}_i$, 半径$r_i(\fat{z})$の円であることは明らかであろう．
一方$\Gamma_{12}(\fat{z})$は，
\begin{equation}
	\Gamma_{12}(\fat{z}): \, r_1(\fat{x})+r_2(\fat{x})=r_1(\fat{z}) +r_2(\fat{z})
	\label{eqn:}
\end{equation}
だから，$\fat{y}_1$と$\fat{y}_2$を焦点とする楕円を表す．
以上のことを踏まえ，$M=2$の場合の曲線群の配置を示すと図\ref{fig:XXX_locii}のようになる．
この図の(a)は二点$\fat{y}_1$と$\fat{y}_2$が十分離れている場合，(b)は近接している場合に
ついて，示したもので，散乱体位置$\fat{z}$を原点としている．
この場合，２つの円とだ円は全て原点で交わり，このことから，点散乱体が座標原点にあることが読み取れる．
\begin{figure}[h]
	\begin{center}
	\includegraphics[width=0.6\linewidth]{Figs/locii.pdf} 
	\end{center}
	\caption{曲線$\Gamma_{ij}(\fat{z})$の配置．$M=2$，点散乱体位置を原点とした場合.(a)は送受信点が離れている場合,(b)は近接している場合.} 
	\label{fig:XXX_locii}
\end{figure}
%\begin{figure}[h]
%	\begin{center}
%	\includegraphics[width=0.8\linewidth]{Figs/wvfm2.pdf} 
%	\end{center}
%	\caption{2つの送受信子を使った点散乱体からのエコー観測.} 
%	\label{fig:XXX_wvfm2}
%:\end{figure}
これまでの議論では，$\delta_\sigma(s)$において$\sigma$が十分小さいとする
仮定のもと，パルス布を考慮せず$\Gamma_{ij}$の配置だけを見てきた. 
しかしながら，実際に送受信される波形では，パルス幅を自由に任意に小さくすることはできない．
従って，開口合成画像上で，個々の曲線$\Gamma_{ij}$を完全に正確に特定することはできず，
散乱体位置の推定にも曖昧さが残る．このような効果をみるために，
図\ref{fig:XXX_locii}の二つのケースに対応する開口合成像を，
式(\ref{eqn:XXX_saft_model_k1})において適当な$\sigma$与えて合成してみる．
図\ref{fig:XXX_saftM2}はその結果をグレースケールで示したもので，明るい
色で示された箇所が大きな画素値に対応する．
なお，これらの画像の計算では，ガウス関数の拡がりによる影響を見ることを
目的としているため，式(\ref{eqn:XXX_saft_model_k1})において，$\delta_\sigma(s)$
以外の項は1としている．
画素値は，点散乱体の強度に比例する量と考えてよいので，大きな画素値を持つ部分に
散乱体が存在する可能性が高いと解釈できる．
図\ref{fig:XXX_saftM2}(a)では，座標原点位置に明確な画素値のピークが現れており
この場合は点散乱体位置の特定が容易である．一方，(b)の場合，大きな画素値を持つ
領域が拡がっていて，ピーク位置，すなわち，散乱体位置が読み取りにくい．
各画像ピクセルの画素値を一つ一つ調べれば，画像(b)でもピーク位置の特定は可能である．
しかしながら，計測波形を用いて像合成を行う場合，画像(b)のようななだらかな
ピークを示す画像では，計測ノイズの影響でピーク位置の推定結果が大きく変化する
可能性がある．
%さらに言えば，画像化の最終目的が散乱体形状の再構成にあることを考えると，
%合成された画像において”点"乱体は"点"のように再構成されるべきである．
以上から，画像(a)は画像(b)よりも望ましいものと言える．

このように，同数の波形を用いて画像化を行う場合でも，観測点の配置に
よって得られる結果が大きく異なることがある．このことを考えると，どのように
観測点を配置することが画像化上有利なのかという疑問が湧く．
図\ref{fig:XXX_saftM2}の結果によれば，観測点が互いにある程度離れている方が
よいことは明らかである．この理由は次のように説明できる．
はじめに図\ref{fig:XXX_locii}(a)をみると，$\Gamma_{ij}$は散乱体位置(原点)
互いに大きく異なる方向を向いている．一方，同図の(b)では，3つの曲線が
概ね同じ方向を向き，浅い角度で交差している．その結果として(a)では(b)よりも
交点位置が読み取り易くなっている．このことは，$\Gamma_{ij}$の向きが，点散乱体位置$\fat{z}$
において，互いにできるだけ異なる方向を向くことが画像化上望ましいことを意味する．
曲線上の各点における向きは，接線でなく法線ベクトルで表すこともできる．
従って，位置$\fat{z}$にある点散乱体を画像化する上で望ましい条件は，
曲線群(\ref{eqn:XXX_Crvs})の$\fat{z}$における法線ベクトルの向きに
偏りが無いこと，と言い換えることができる．
$\Gamma_{ij}(\fat{z})$の，位置$\fat{z}$における単位法線ベクトルを$\fat{n}_{ij}(\fat{z})$と
すれば，これは次のように与えられる．
\begin{equation}
	\fat{n}_{ij}(\fat{z}) 
	=\frac{\nabla_z \left\{ r_i(\fat{z})+r_j(\fat{z})\right\}}
	{\left| \nabla_z \left\{r_i(\fat{z})+r_j(\fat{z})\right\})\right|}
	=\frac{
		\hat{\fat{r}}_i(\fat{z})+\hat{\fat{r}}_j(\fat{z})
	}{
		\left| \hat{\fat{r}}_i(\fat{z})+\hat{\fat{r}}_j(\fat{z}) \right|
	}
	\label{eqn:XXX_08}
\end{equation}
ただし$\hat{\fat{r}}_i$は次の式で与えられる単位ベクトルを表す．
\begin{equation}
	\hat{\fat{r}}_i(\fat{z}):=
	\frac{\fat{z}-\fat{y}_i}
	{\left| \fat{z} -\fat{y}_i\right|}
	\label{eqn:XXX_ri_hat}
\end{equation}
$i=j$のとき，
\begin{equation}
	\fat{n}_{ii}(\fat{z})=\hat{\fat{r}}_i(\fat{z})
	\label{eqn:normal_pecho}
\end{equation}
で，散乱体位置$\fat{z}$から送受信点$\fat{y}_i$を指す単位ベクトルに一致するという
単純な結果が得られる．このことは，パルスエコーモードで観測を行う場合，
$\fat{n}_{ii}$が各々異なる方向を向くよう，点散乱体位置$\fat{z}$からみて一定間隔の方位
に観測点$\fat{y}_i$を配置することが望ましいことを意味する．
実際の探傷では，散乱体位置は未知であるため，この方針に厳密に従って
観測点を配置することはできない．ただし，送受信点が画像化範囲から十分遠方にある場合，
座標原点を散乱体付近に取ることができれば，近軸近似(paraxial approximation)により，
\begin{equation}
	\hat{\fat{r}}_i(\fat{z}) \simeq \hat{\fat{y}}_i:= \frac{\fat{y}_i}{|\fat{y}_i|}
	, \ \ (|\fat{z}|\ll |\fat{y}_i|)
	\label{eqn:XXX_09}
\end{equation}
と表すことができる．従ってこの場合，法線ベクトルを
\begin{equation}
	\fat{n}_{ij} \simeq  
	\fat{\xi}_{ij}:=
	-\frac{\hat{\fat{y}}_i+\hat{\fat{y}}_j}
	{| \hat{\fat{y}}_i+\hat{\fat{y}}_j|}
	\label{eqn:XXX_10}
\end{equation}
と，散乱体位置$\fat{z}$に依存しない形で表すことができる．
以上より，式\ref{eqn:XXX_10}で与えられるベクトル$\fat{xi}_{ij}$が
互いに異なる方向となるように観測点$\cal A$を配置することが，良好な
開口合成像を得るための一つの指針となる．
逆に言えば，異なる送受信点で得られた二つのAスキャン波形$a_{ij}(t)$と
$a_{i'j'}(t)$があり，もし$\fat{\xi}_{ij}\simeq \fat{\xi}_{i'j'}$
ならば，どちらか一方の波形を使えばよく，両方を用いることによって
散乱体位置特定における解像度の向上は期待できない．
このような状況は頻繁に生じることは，次のような簡単な例で理解することができる．
%このような近似は，$a_{ij}$を，方向$\hat{\fat{y}}_i$から到来する平面波
%で励起された散乱波のうち，方向$\hat{\fat{y}}_j$で観測することに相当する．
%位置$\fat{x}$にある点散乱体を開口合成画像中で正確に特定するためには，
%$\fat{n}_{ij}$の方向が様々に変化するように観測点$\fat{y}_i$が配置されている必要である．
%
%逆に，どの送受信点の組み合わせでも$\fat{n}_{ij}$にあまり大差が無い場合，
%画像中の点散乱体の指示が拡がり，散乱体位置の特定が難しくなる．さらに言えば，
%観測Aと別の観測Bにおいて法線ベクトルが同じ場合，観測Aに加えてBを行うことで
%位置特定の解像度をあげる効果は期待できない．このような状況は頻繁に生じる．

図\ref{fig:XXX_blind_sum}(a)のような状況で$M=2$の観測データ
${\cal D}({\cal M}^2)$を得たとする．
このとき，${\cal D}({\cal M}^2)$の一部
\begin{equation}
	\left\{ 
		a_{11}(t), a_{22}(t), a_{12}(t) 
	\right\}
	\label{eqn:}
\end{equation}
を用いて，式(\ref{eqn:XXX_saft_model_k1})で開口合成を行うと，
同図(b)の結果が得られる．この場合，散乱体位置である原点での
法線ベクトルは，
\begin{equation}
	\fat{\xi}_{11}=(-\sin\theta,\cos\theta), \,
	\fat{\xi}_{22}=( \sin\theta,\cos\theta), \,
	\fat{\xi}_{12}=(0,1)
	\label{eqn:XXX_11}
\end{equation}
である．従って，画像合成に用いた波形のうち，法線ベクトルが互いに近い
向きにあるものは無い．一方，${\cal D}({\cal M}^2)$全てを使って
像合成を行うと，図\ref{fig:XXX_blind_sum}(c)が得られる．
(b)と(c)では，(c)の方が大きな画素値を持つ範囲がより水平方向により広いことが分かる．
また，曲線$\Gamma_{12}$に対応するだ円が強調されり,(b)よりも多くの波形を使用した
にも関わらず，点散乱体の位置や形状をみるための画像としての改善が見られない．
これは，同じ法線ベクトル$\fat{\xi}_{12}=\fat{\xi}_{21}$をもつ
$a_{12}(t)$と$a_{21}(t)$を同じ重みで加算したことによる．このように，得られた
波形全てを単に足し込むだけで画像の質が向上する訳でなく，
曲線群(\ref{eqn:XXX_Crvs})の法線ベクトル$(\fat{n}_{ij}\simeq \fat{\xi}_{ij})$が
重複無く，広い範囲でサンプリングされるように送受信位置をとることが重要
であることを意味している．
\begin{figure}[h]
	\begin{center}
	\includegraphics[width=.6\linewidth]{Figs/saftM2.pdf} 
	\end{center}
	\caption{開口合成画像の例.(a)送受信点が離れている場合,(b)送受信点が近接している場合.} 
	\label{fig:XXX_saftM2}
\end{figure}
\begin{figure}[h]
	\begin{center}
	%\includegraphics[width=0.9\linewidth]{Figs/blind_sum.eps} 
	\includegraphics[width=0.9\linewidth]{Figs/blind_sum.pdf} 
	\end{center}
	\caption{(a)送受信条件と,(b),(c)開口合成像．(b)は$w_{21}=0$の場合, (c)は4つの波形全てを用いた場合.}
	\label{fig:XXX_blind_sum}
\end{figure}
%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{点拡がり関数(point spread function)}
\subsubsection{パルス波の場合}
点散乱体が一つだけ存在することが分かっている場合，2点での観測波形から位置特定が
可能であることをみた．一方，合成された画像から，散乱体形状が点であることを知るには，
これまでに示した少数の観測結果からの開口合成が十分でないことは明らかである．そこで，
適切に配置された送受信点を多数とることで，点散乱体の形状をより忠実に表現できること
をみていく．

はじめに，原点におかれた点散乱体に対し，原点を中心とする円を観測面にとる．
この円上を等間隔に$M$個の送受信点を配置する．
これら$M$個の送受信点の$M^2$個の組合わせの中には，エコー投影曲線の法線ベクトルが互いに
一致する，あるいは近い方向となるものが多数ある．そこで，法線ベクトルの重複を
避けるため，パルス-エコーモードでの観測データ(式(\ref{eqn:XXX_pecho}))を画像化に用いる．
この場合，$\fat{\xi}_{ii}$は単位円上に等間隔で配置され，互いに一致することがない．
以上の設定で，前節と同様，式(\ref{eqn:XXX_saft_model_k1})によって$I_\sigma(\fat{x})$
を計算する．図\ref{fig:XXX_psf_pulse}はその結果として得られた開口合成像を示したものである．
この図の(a)は，送受信点数を$M=10$とした場合，(b)は$M=20$の結果である．
どちらのケースでも，全周方向から計測を行っているため，原点に集中した
等方的な分布が得られ，点散乱体の画像と呼ぶにふさわしい画像が得られている．
%%%
理想的な画像化システムでは，点散乱体がデルタ関数として再構成される．
現実の画像化システムでは，散乱体近傍に集中した分布が得られたとしても，
完全な点として画像化されることはない．点散乱体を撮像したときに得られる
滲んだ画像，すなわち，画像化システムのデルタ関数入力に対する応答は，
点拡がり関数(PSF:point spread function)と呼ばれる．この定義に従えば，
図\ref{fig:XXX_psf_pulse}は，観測点数を$M=10$あるいは20としたときの
PSFであるということができる．これら二つのPSFは，原点近傍をみる限り
大差がないが，原点から離れたところでは$M=10$の場合に凹凸が目立つ．
図\ref{fig:XXX_psf_profile}は， この様子を詳しくみるために 
$y=0$におけるPSFの断面図を示したものである．
この結果から明らかなように， メインローブは観測点数によらず
ほとんど一致している．
メインローブ幅は，複数の点散乱体があるとき，互いに接近した点散乱体が
画像上で区別できるかどうかの指標となるため，画像化システムの分解能
とみなすことができる．図\ref{fig:XXX_psf_pulse}と図\ref{fig:XXX_psf_profile}
の結果は，観測が全周方向から行われる場合，観測点数を増やしても分解能は
変わらないことを示している． 方，メインローブの外側では，観測点数が少ない
$M=10$で，より分布の裾野が広く，わずかにサイドローブも生じている．サイドローブや
サイドローブの干渉によって生じる指示は，実際には存在しない物体の像として誤認
されることがあり，偽像と呼ばれる．図\ref{fig:XXX_psf_profile}は，観測点数を
増やすことには偽像の発生を抑える効果があることを示唆している．

次に，観測方向が制限されることによって生じる画像の劣化についてみてみる．
そのために， 観測点間隔を15度に保ち，観測点数を(a)24点として全周方向に配置した
場合，(b)13点,半周，(c)9点,120度,(d)5点，60度としたそれぞれの場合について
PSFを計算する．図\ref{fig:XXX_psf_aptlim}はその結果を示したものである．
いずれのケースでも原点にピークを持つ分布が得られているが，
観測方向が半周に制限された(b)では，画像は上下非対称で，鉛直方向にメインローブ
の幅が若干広い．また，(c)の場合，メインローブの形状は明らか等方的でなく，
観測点が配置されて方向と直交する方向に伸びた形になっている．
この傾向は，最も制約の厳しい(d)で一層顕著で，もはや(d)の画像から
散乱体が点状のものか，小さな平板状のものか区別することが難しくなる．
実際の超音波探傷試験では，欠陥に対して全周方向からの計測ができる
ことはほとんどない．むしろ，(d)のケースのように，観測方向が狭い範囲に
制限されることが普通である．このことから，観測方向の制限による画像の劣化挙動
を理解しておくことは，探傷データを使った画像化と欠陥評価において重要である．
\begin{figure}[h]
	\begin{center}
	%\includegraphics[width=1.0\linewidth]{Figs/psf_pulse.eps} 
	\includegraphics[width=1.0\linewidth]{Figs/psf_pulse.pdf} 
	\end{center}
	\caption{全周方向からパルス-エコーモードで送受信したときの開口合成像.(a)$M=10$, (b)$M=20$の場合.} 
	\label{fig:XXX_psf_pulse}
\end{figure}
\begin{figure}[h]
	\begin{center}
	%\includegraphics[width=0.6\linewidth]{Figs/psf_profile.eps} 
	\includegraphics[width=0.6\linewidth]{Figs/psf_profile.pdf} 
	\end{center}
	\caption{$y=0$における開口合成像の断面図. 観測点数(a)$M=10$, (b)$M=20$.}
	\label{fig:XXX_psf_profile} 
\end{figure}
\begin{figure}[h]
	\begin{center}
	%\includegraphics[width=0.9\linewidth]{Figs/psf_aptlim.eps} 
	\includegraphics[width=0.9\linewidth]{Figs/psf_aptlim.pdf} 
	\end{center}
	\caption{開口を制限したときの点散乱体の開口合成像(送受信点の配置間隔は15度，観測点数と観測範囲は
	(a)24点,360度, (b)13点,180度, (c)9点,120度, (d)5点.60度.} 
	\label{fig:XXX_100}
\end{figure}
\subsubsection{連続波の場合}
ここまでの議論では，任意の幅をもつパルス波を送受信できることを前提としてきた．
実際の計測では周波数帯域の制限により，任意の幅と形状のパルス波を送受信することはできない．
特に，圧電素子を用いた計測では一定の時間振動する波形が得られることが普通で，振動継続時間は
センサーの駆動電圧を調整することでは自由に制御出来ない場合がある．
そのため，振動する波形を用いた場合に，どのような開口合成像が得られるかを
理解しておくことは実探傷波形によるイメージングを行う上で有用である．
ここでは，振動する波形の極端なケースとして，単一周波数成分からなる連続波
を画像化に用いた場合のPSFについて検討する．

パルス波を使った画像化関数を導出する際，時間領域のグリーン関数$G(\fat{x},\fat{y},t)$を用いて
Aスキャン波形を表した．連続波を送受信する場合は，周波数領域のグリーン関数:
\begin{equation}
	\tilde G(\fat{x},\fat{y},\omega)
	=
	\frac{e^{ikr}}{r}, \ \ (r=\left| \fat{x}-\fat{y} \right|)
	\label{eqn:}
\end{equation}
を用いてAスキャン波形を表す．なお，$\omega$は角周波数を，$k$は波数を表し，
両者の間には$\omega=kc$の関係がある．このとき，$a_{ij}(t)$は次にように表すことができる．
\begin{eqnarray}
	a_{ij}(t)
	&=&
	\sum_k 
	s_k \tilde G(\fat{z}_k,\fat{y}_i,\omega)G(\fat{y}_j,\fat{z}_k,\omega)e^{-i\omega t} \\
	&=&
	\sum_k \frac{s_k}{r_i(\fat{z}_k)r_j(\fat{z}_k)}
	\exp\left\{
		ik\left( 
			r_i(\fat{z}_k)+r_j(\fat{z}_k)
		\right)
		-i\omega t
	\right\}
	\label{eqn:XXX_aij_wt}
\end{eqnarray}
式(\ref{eqn:XXX_aij_wt})を式(\ref{eqn:XXX_saft})に代入すれば
\begin{equation}
	I(\fat{x})
		=
	I_\omega(\fat{x})
		:=
	\sum_{\cal D} \sum_{k}
	\frac{w_{ij}^*s_k}{r_i(k)r_j(k)} 
	\exp \left\{ 
	ik
	\left(
		r_i(\fat{x})+r_j(\fat{x})-r_i(\fat{z}_k)-r_j(\fat{z}_k)
	\right)
	\right\} 
	\label{eqn:XXX_Iwt}
\end{equation}
が得られる．ここに，$\omega_{ij}^*$は式(\ref{eqn:wij_model})で与え，
連続波から得られる画像であることを明示するために$I(\fat{x})=I_\omega(\fat{x})$と表した．
式(\ref{eqn:eqn:XXX_Iwt})の指数関数の項は，振動する関数で，
位相
\begin{equation}
	\phi_{ij}(\fat{x})=k 
	\left(
		r_i(\fat{x})+r_j(\fat{x})-r_i(\fat{z}_k)-r_j(\fat{z}_k)
	\right)
	\label{eqn:}
\end{equation}
が$\pi$の整数倍となる位置で繰返しピークを示す．
従って，パルス波を用いた場合とは異なり、$\phi_{ij}(\fat{x})=2m\pi, (m=0,\pm 1, \pm 2,\dots)$
で定義される波面群の干渉によって像合成が行われることが分かる．
ここで，式(\ref{eqn:XXX_Iwt})に基づいてPSFを計算するために，単一の点散乱体を原点$\fat{o}$に置く．
この場合，$r_i(\fat{z})=|\fat{y}_i|$で，$k=1$のみだから，インデックス$k$を省略して，
\begin{equation}
	I_\omega(\fat{x})
		:=
	\sum_{\cal D} 
	\frac{w_{ij}^*s}{|\fat{y}_i||\fat{y}_j|} 
	\exp \left\{ 
	ik
	\left(
		r_i(\fat{x})+r_j(\fat{x})-|\fat{y}_i|-|\fat{y}_j|
	\right)
	\right\}
	\label{eqn:}
\end{equation}
と表す．さらに，原点を中心とする半径$R$の円周上に観測点を取り，
パルス-エコーモードでの送受信を想定する．その場合，
$|\fat{y}_i|=R$だから，画像化関数は次のようになる．
\begin{equation}
	I_\omega(\fat{x})
		:=
	\sum_{\cal D} 
	\frac{w_{ij}^*s}{R^2}
	e^{
	2ik
	\left(
		r_i(\fat{x})-R
	\right)
	}
	\label{eqn:XXX_PSF_cont}
\end{equation}
この実部が単一周波の連続波を用いてパルスエコー法で計測した
場合のPSFを与える．いま，式(\ref{eqn:XXX_psf_cont})を，
観測点数$M=10$および20で計算すると，
図\ref{fig:XXX_PSF_mono}のような像が得られる．
\begin{figure}[h]
	\begin{center}
	%\includegraphics[width=0.9\linewidth]{Figs/psf_cont.eps} 
	\includegraphics[width=0.9\linewidth]{Figs/psf_cont.pdf} 
	\end{center}
	\caption{
	全周方向からパルス-エコーモードで送受信したときの点拡がり関数.
	観測点数は(a)$M=10$, (b)$M=20$で，波長2の連続波を用いた場合.} 
	\label{fig:XXX_psf_cont}
\end{figure}
\begin{figure}[h]
	\begin{center}
	%\includegraphics[width=0.6\linewidth]{Figs/psf_profile_cont.eps} 
	\includegraphics[width=0.6\linewidth]{Figs/psf_profile_cont.pdf} 
	\end{center}
	\caption{$y=0$における点広がり関数の断面図. 
	観測点数は(a)$M=10$, (b)$M=20$で，波長2の連続波を用いた場合.}
	\label{fig:XXX_psf_profile_cont}
\end{figure}
これら二つのPSFの，$y=0$における断面は図\ref{fig:ZZ_psf_profile_cont}のようである．
このように，観測点数の少ない$M=10$のケースでは顕著なグレーティングローブが発生している．
一方で，単周波数成分の波を用いた場合にも，全周方向からの計測を行った場合には，
原点に明確なメインローブが現れることが分かる．
なお，メインローブ幅は，次のようにして理論的に見積もることができる．

第$i$番目の測定点$\fat{y}_i$の，方向を$\theta_i$とし，測定方向間隔を
\begin{equation}
	\Delta \theta = \theta_{i+1}-\theta_i
	\label{eqn:}
\end{equation}
と表す．PSFの式(\ref{eqn:XXX_PSF_cont})を，$\Delta \theta$を用いて
\begin{equation}
	I_\omega(\fat{x})
		=
	\sum_{i} 
	e^{
	2ik
	\left(
		r_i(\fat{x})-R
	\right)
	}
	\Delta \theta
	\label{eqn:XXX_PSF_dth}
\end{equation}
となるように$w_{ij}$を与えたとする．この極限
$\Delta \theta \rightarrow 0$，すなわち$M\rightarrow \infty$を取れば，
PSFを積分を使って次のように表すことができる．
\begin{equation}
	I_\omega(\fat{x})
		=
	\int_{-\pi}^{\pi}
	e^{
	2ik
	\left(
		r_i(\fat{x})-R
	\right)
	}
	d\theta
	\label{eqn:XXX_PSF_int}
\end{equation}
ここで，$R\gg |\fat{x}|$として光軸近似
\begin{equation}
	r_i=R-\fat{x}\cdot \hat{\fat{y}}
	\label{eqn:}
\end{equation}
を用いれば，式(\ref{eqn:XXX_PSF_int})は次のようになる．
\begin{equation}
	I_\omega(\fat{x})
		=
	\int_{-\pi}^{\pi}
	e^{
	-2ik \fat{x}\cdot \hat{\fat{y}}
	}
	d\theta
	\label{eqn:XXX_PSF_int2}
\end{equation}
そこで，測定点方向$\theta$を，画像化点$\fat{x}$の方向から測った
角度で表すと，PSFが
\begin{equation}
	I_\omega(\fat{x})
		=
	\int_{-\pi}^{\pi}
	e^{
	-2ik |\fat{x}| \cos \theta
	}
	d\theta
	=
	2\pi J_0(2k\left|\fat{x}\right|)
	\label{eqn:XXX_PSF_J0}
\end{equation}
と，0次，第一種のベッセル関数$J_0(z)$を使って表すことができる．
$J_0(z)$の最小のゼロ点を$z=z_0(\simeq 2.405)$として，
\begin{equation}
	2k|\fat{x}_0|=\frac{4\pi}{\lambda}|\fat{x}|=z_0
	\label{eqn:}
\end{equation}
となる距離$|\fat{x}|=\fat|\fat{x}_0|$を求めれば，
PSFのメインローブ幅$w_{l}$はその2倍と考えて良い．
そこで，上の式を$|\fat{x}_0|$について解き，
波長$\lambda=\frac{2\pi}{k}$との比で表せば，
\begin{equation}
	\frac{|\fat{x}|}{\lambda}=\frac{z_0}{4\pi}\simeq 0.191
	\label{eqn:}
\end{equation}
より，メインローブ幅はおよそ$\frac{w_l}{\lambda}\simeq 0.382$となる．
$w_l$は画像化システムの分解能とみなすことができるが，
この結果を導くた上での仮定が，実際の画像化システムで完全に満足される
ことは無い．従って，$w_l$は画像化システムのが達成しうる理論上の限界値とみる必要がある．
また，3次元画像化問題では，PSFのメインローブ幅は2次元問題に比べて
若干大きくなる．
3次元問題として考えるために，観測点を点散乱体を中心とする半径$R$の球面上に
とり，パルス-エコー法で送受信したとする．このとき，$w_{ij}$を調整して，
式(\ref{eqn:XXX_PSF_cont})において$w_{ij}s/R^2$の項が単位球面$\Omega$上の
微小面積要素となるように取れば，PSFは次のような積分で表され，
0次の球ベッセル関数$j_0(z)$を使って書くことができる．
\begin{equation}
	I_\omega(\fat{x})
		=
	\int_\Omega
	%\exp \left(
	e^{
	-2ik |\fat{x}| \cos \theta
	}
	\sin\theta
	d\theta d\phi
	=
	4\pi j_0(2k\left|\fat{x}\right|)
	\label{eqn:XXX_PSF_J0}
\end{equation}
球ベッセル関数$j_0(z)$は
\begin{equation}
	j_0(z)=\frac{\sin z}{z}
\end{equation}	
だから，最小のゼロ点は$z_0=\pi$となることは明らかである．
これを使ってメインローブ幅$w_l$を計算すれば
\begin{equation}
	\frac{w_l}{\lambda}=\frac{1}{2}
	\label{eqn:}
\end{equation}
となる．すなわち， 開口合成法による画像化の分解能は半波長で，
観測点数や配置の最適化で分解能を超えることは原理的にできない．
\subsubsection{位相遅れの影響}
これまでのPSFの計算では，入射波の位相は送信点で正確に0となっていることを
仮定してきた．しかしながら，この仮定は実際の超音波の送信では満足されない．
そこで，入射波に$\pi \delta$の位相遅れがある場合のPSFの劣化について
調べる．ここでは，$\delta=0.2,0.4$および$0.6$のそれぞれについてPSFを
計算し，位相遅れが無い($\delta =0$)の場合と比較する．
図\ref{fig:XXX_psf_cont_delay}はその結果を，断面図として示したものである．
この図にあるように，どのケースでもメインローブの位置と幅には大きな変化がない．
一方で，メインローブ高さは，位相遅れが大きいほど低くなる．メインローブ
高さの低下は，サイドローブをはじめとする周囲のピークと混同を招く．
特に散乱体の数が以前に分からない存在する場合には，誤検出や見落とし
の原因となるため十分なメインローブ高さが得られ程度に，位相が正確に
調整されていることが重要である．
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}[h]
	\begin{center}
	%\includegraphics[width=0.6\linewidth]{Figs/psf_cont_delay.eps} 
	\includegraphics[width=0.6\linewidth]{Figs/psf_cont_delay.pdf} 
	\end{center}
	\caption{位相遅れのある入射波を用いたときの点拡がり関数.} 
	\label{fig:XXX_psf_cont_delay}
\end{figure}
\begin{figure}[h]
	\begin{center}
	%\includegraphics[width=0.5\linewidth]{Figs/1D_prb.eps} 
	\includegraphics[width=0.5\linewidth]{Figs/1D_prb.pdf} 
	\end{center}
	\caption{反射壁の開口合成イメージング(1次元問題).} 
	\label{fig:XXX_1D_prb}
\end{figure}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}[h]
	\begin{center}
	%\includegraphics[width=0.6\linewidth]{Figs/psf_cont_delay.eps} 
	\includegraphics[width=0.6\linewidth]{Figs/psf_cont_delay.pdf} 
	\end{center}
	\caption{位相遅れのある入射波を用いたときの点拡がり関数.} 
	\label{fig:XXX_psf_cont_delay}
\end{figure}
\begin{figure}[h]
	\begin{center}
	%\includegraphics[width=0.5\linewidth]{Figs/1D_prb.eps} 
	\includegraphics[width=0.5\linewidth]{Figs/1D_prb.pdf} 
	\end{center}
	\caption{反射壁の開口合成イメージング(1次元問題).} 
	\label{fig:XXX_1D_prb}
\end{figure}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{結像位置のずれ}
図\ref{fig:XXX_psf_cont_delay}の例では，全周方向から観測を行っている．
その結果，入射点で位相遅れがある場合も，メインローブ位置は散乱体位置
と一致している．一方，観測方向が制限される場合は，通常，PSFをのメインローブ
位置，すなわち結像位置にずれが生じ，画像化結果から散乱体位置を正確に
特定することが難しくなる． そこで本節では，入射波に位相遅れがある場合も，
開口合成法で正しい位置に像を得るためのいくつかの技法について述べる．
またその過程で，開口合成法と時間反転法の関係について示す．
\subsubsection{1次元問題}
結像位置のずれを補償する方法を1次元問題で考える．
$x=0$に送受信点をとり，$x=L(>0)$にある壁面からの反射波を観測したとする(図\ref{fig:XXX_1D_prb})．
位相速度を$c$，原点での入射時間波形を$u_0(t)$とすれば，入射場変位$u(x,t)$は，
右進行波だから
\begin{equation}
	u^{in}(x,t)=u_0\left(t-\frac{x}{c}\right)
	\label{eqn:XXX_uin_1D}
\end{equation}
と表される．壁面での反射係数を$R$とすれば，左進行波である反射波$u^r(x,t)$は
\begin{equation}
	u^{r}(x,t)=Ru_0\left(t+\frac{x-2L}{c}\right)
	\label{eqn:XXX_ur_1D}
\end{equation}
と与えられる．従って，$x=0$で反射波を観測されるAスキャン波形は
\begin{equation}
	a_{11}(t)=u^{r}(0,t)=Ru_0\left( t-\frac{2L}{c}\right)
	\label{eqn:XXX_12}
\end{equation}
で，これを使って得られる開口合成像は
\begin{equation}
	I(x)=
	\left. a_{11}\left(t\right)
	\right|_{t=\frac{2x}{c}}
	=
	Ru_0\left(\frac{2}{c}(x-L)\right)
	\label{eqn:XXX_13}
\end{equation}
となる．ここで，入射波波形$u_0(t)$のピーク時刻が$t=t_d(>0)$，
パルス幅が$T$であったとする．その場合，開口合成像$I(x)$のピーク
位置は$x=L+\frac{ct_d}{2}$となり，壁面内側に$\frac{ct_d}{2}$
だけ入った位置にピークが現れ，壁表面の位置は正確に再構成されない．
また，画像中の壁面の指示幅は$cT/2$となり，壁面位置の特定には
パルス幅に応じた曖昧さを伴う．このような，ピーク位置のずれと
曖昧さは，現実の計測系では必ずつきまとうため，その補償を行う
メカニズムを持つ画像化方法を用いることが望ましい．以下では，
そのために利用可能な3つの方法について述べる．
\paragraph{時間軸原点の補正}
もっとも単純なピーク位置の補正方法は，計測波形を時間軸上であらかじめ$t_d$だけシフトし，
$a_{11}(t+t_d)$を用いて開口合成を行うことである．これは，時間軸原点$t=0$を
送信時のトリガー信号で決まる時刻でなく，入射波形のピーク時刻とすることを意味する．
このとき，$t_d$には波形の立ち上がり時間だけでなく，超音波探触子内の前面板や
シューを通過するための時間も含め，さらに伝播および受信過程で生じる波形の
ひずみも考慮する必要がある．従って，時間軸の調整量$t_d$は，送受信センサー内部の
伝播時間と，想定される波形のひずみを参照試験片を使った計測結果等から
予め評価して与えることになる．
\paragraph{参照波形を使ったデコンボリューション}
%時間軸原点の補正によって正しい位置に像が得られるためには，入射波と反射波の波形が
%変化しないことが前提となる．これは，1次元線形弾性問題の場合には当てはまるが，
%多次元問題では球面波や平面波の平面境界による反射といった特殊なケースに限られる．
%一般には，入射波形と反射波形は異なり，両者の立ち上がり時間も異なることから, 時間軸原点
%位置の補正う結像位置が状況に応じて変化することになる．
時間軸原点の補正によって結像位置の調整は可能だが，パルス幅分の位置に関する曖昧さは改善しない．
デコンボリューション波形を用いる画像化は，時間軸の補正とパルス幅の圧縮を同時に行い，
これら両面で画質の改善を行う方法である．
観測波形のデコンボリューションには，既知の反射壁からのエコーを計測し，参照波形として用いる．
いま，既知の反射壁位置が$x=L_0$にあったとする．
このとき，反射波変位$u^{r}(x,t)$が，
\begin{equation}
	u^{r}(x,t)=Ru\left(t+\frac{x-2L_0}{c}\right)
	\label{eqn:XXX_14}
\end{equation}
と書けることは，式(\ref{eqn:XXX_ur_1D})と同様で，参照波形として用いる
Aスキャン波形$a_0(t)$は，
\begin{equation}
	a_0(t)=u^{r}(0,t)=
	Ru\left(t+\frac{2L_0}{c}\right)
	\label{eqn:XXX_15}
\end{equation}
である．ここで，時間に関するフーリエ変換対を
\begin{eqnarray}
	F(\omega)={\cal F}\{ a(t)\} &:=&  \int f(t)e^{i\omega t} dt \\
	{\cal F}^{-1}\{ F(\omega)\} &:=&  \frac{1}{2\pi} \int F(\omega)e^{-i\omega t} dt 
\end{eqnarray}
で定義し，$a(t)$と$a_0(t)$のフーリエ変換をとる．
その結果を
\begin{equation}
	A(\omega)={\cal F}\{a(t)\}, \ \ 
	A_0(\omega)={\cal F}\left\{ a_0(t)\right\}
	\label{eqn:XXX_16}
\end{equation}
とする．これらは，入射波形$u_0(t)$のフーリエ変換を${\cal F}\{ u_0(t)\}=U(\omega)$とすれば
\begin{equation}
	A(\omega) = RU(\omega) e^{2ik L},  \ \
	A_0(\omega) = RU(\omega) e^{2ik L_0}, 
	\label{eqn:XXX_17}
\end{equation}
と表される．そこで，デコンボリューション$A(\omega)/A_0(\omega)$に，
周波数領域での時間シフト$e^{2ikL_0}$をかけてフーリエ逆変換を行えば，
\begin{equation}
	\tilde a(t)= {\cal F}^{-1} \left\{ 
	\frac{A(\omega)}{A^{ref}(\omega)} e ^{2ik L_0}
	\right\}
	=\delta \left(t-\frac{2L}{c}\right)
	\label{eqn:XXX_at_dcnv}
\end{equation}
と，デルタ関数となる．これを観測波形$a(t)$の代わりに用いて開口合成を行えば，
画像化関数は
\begin{equation}
	I(x)=\delta\left( \frac{2(x-L)}{c}\right)
	\label{eqn:XXX_}
\end{equation}
となり，反射壁表面にピークをもつ画像が得られる．
勿論,式(\ref{eqn:XXX_at_dcnv})のデコンボリューションは，計測系の周波数帯域制限と
観測ノイズのために，全ての周波数で正確に評価することは出来ない．
そのため，実際に得られる$\tilde a_{11}$は劣化したデルタ関数となる．
例えば，周波数帯域が$(-\omega_b,\, \omega_b)$に制限されるとき，
帯域内でノイズが無いと仮定しても，式\ref{eqn:XXX_at_dcnv}のフーリエ逆変換は
\begin{equation}
	\tilde a(t)= 
	\int_{-\omega_b}^{\omega_b} 
	e^{2ikL-i\omega t} d\omega 
	=\frac{\sin\left\{ \omega_b \left( t-\frac{2L}{c}\right)\right\}}{\pi \left(t-\frac{2L}{c}\right)}
	\label{eqn:XXX_18}
\end{equation}
となる．この例からも分かるように，デコンボリューションで得られる信号は，観測波形に
比べてパルス幅が圧縮され，圧縮の程度は帯域幅$\omega_b$に依存する．
また，実際の計測では， 参照波形と画像化に用いるAスキャン波形の周波数スペクトルが
完全に一致することは無く，この点でもデコンボリューションは完全なものとならない．
結局のところ，デコンボリューションの成否は，対象とするAスキャン波にどれだけ近い
参照波形を用いることができるかという点にかかっている．きずに関して得られている情報に基づき，
できるだけ実情にあったモデルや試験体で参照波形の取得を行うことが，デコンボリューションによる
波形処理を用いる上で重要となる．
\paragraph{時間反転法}
入射場$u^{in}(x,t)$と反射場$u^{r}(x,t)$がそれぞれ得られているとし，
各々の時間に関するフーリ変換を
\begin{equation}
	U^{in}(x,\omega)={\cal F} \{ u^{in}(x,t)\}, \ \ 
	U^{r}(x,\omega)={\cal F} \{ u^{r}(x,t)\}
	\label{eqn:XXX_19}
\end{equation}
と表し，角周波数に関する次のような積分を考える．
\begin{equation}
	{\cal I }(x)=
	\frac{1}{2\pi}
	{\rm Re }
	\int 	
	U^{in}(x,\omega)\left( U^{r}(x,\omega)\right)^* d\omega
	\label{eqn:XXX_20}
\end{equation}
ここで，$\left<f,g\right>$は次式で定義される，複素数値関数$f(x)$と$g(x)$の内積を表す．
\begin{equation}
	\left< f,g\right>=\int f(x)g^*(x)dx
	\label{eqn:XXX_21}
\end{equation}
また，以下では内積から導入されるノルムを
\begin{equation}
	\left\| f \right\|^2=\left<f,f\right> =\int |f(x)|^2dx
	\label{eqn:XXX_21}
\end{equation}
と表す． なお，以上において$(\cdot)^*$は複素共役を意味する．
$U^{in}$と$U^{r}$を具体的に書くと，
\begin{equation}
	U^{in}(x,\omega)=U(\omega)e^{ikx}, \ \ 
	U^{r}(x,\omega)=RU(\omega)e^{-ik(x-2L)}
	\label{eqn:XXX_22}
\end{equation}
だから，${\cal I}(x)$は
\begin{equation}
	{\cal I}(x)
	=
	\frac{1}{2\pi}
	{\rm Re }
	\left\{ 
	\left< U^{in},U^{r}\right>
	\right\}
	=
	\int 
	\left| U(\omega) \right|^2 
	R
	e^{2ik(x-L)}d\omega
	\label{eqn:XXX_pcnj}
\end{equation}
である．式(\ref{eqn:XXX_pcnj})は，シュワルツの不等式より
\begin{equation}
	Re \left\{ \left< U^{in}, U^{r}\right> \right\}
	\leq 
	\left| \left< U^{in},U^{r} \right> \right|
	\leq  \left\| U^{in}\right\| \left\| U^{r}\right\|
	=\left| R \right|
	\left\| U\right\|^2
	\label{eqn:XXX_23}
\end{equation}
だから，${\cal I}$は
\begin{equation}
	{\cal I}(x) \leq R \left\| U \right\|^2
	\label{eqn:}
\end{equation}
を満たす．また，式(\ref{eqn:XXX_pcnj})より${\cal I}(L)=R \left\| U\right\|^2$だから，
式(\ref{eqn:XXX_23})の等号は$x=L$で成立して${\cal I}(x)$の最大値を与える．
このことから，${\cal I}(x)=Re \left<U^{in},U^{r}\right>$を画像化関数として
用い，反射の表面を再構成できると期待される．さらに，式(\ref{eqn:XXX_pcnj})は，
パーセバルの等式を用い，時間$t$に関する次のような積分に書き直すことができる．
\begin{equation}
	{\cal I}(x)= \left< u^{in}(x,t), u^{r}(x,t)\right>
	=\int u^{in}(x,t), u^{r}(x,t) dt
	\label{eqn:XXX_I_ut}
\end{equation}
ここで,$u^{in}(x,t)$と$u^r(x,t)$は実信号だから,積分の結果は実数値を与える．
式(\ref{eqn:XXX_I_ut})による画像化は，以下の理由から開口合成法の一般化とみなすことができる．


反射波変位$u^{r}(x,t)$は，観測波形$a_{11}(t)$を用いて
\begin{equation}
	u^r(x,t)=a_{11}\left(t+\frac{x}{c}\right)
	\label{eqn:}
\end{equation}
と表すことができる．これを式(\ref{eqn:XXX_I_ut})に用いることで，
\begin{eqnarray}
	{\cal I}(x) &= & 
	\int u^{in}(x,t) a_{11}\left(t+\frac{x}{c}\right) dt
	\\
	&=&
	 \int u^{in}\left(x,t-\frac{x}{c}\right) a_{11}\left(t\right) dt \\
	&=&
	\left< u^{in}\left(x,t-\frac{x}{c}\right), a_{11}(t) \right>
	\label{eqn:XXX_I_at}
\end{eqnarray}
とすることができる．ここで，入射波波形$u_0(t)$を(実際とは異なるとしても)
理想的なパルスであるとして$u_0(t)=\delta(t)$とする．
このとき，
\begin{equation}
	u^{in}(x,t)=
	u_0\left(t-\frac{x}{c}\right)
	=
	\delta \left(t-\frac{x}{c}\right)
	\label{eqn:}
\end{equation}
より， 式(\ref{eqn:XXX_I_at})は
\begin{equation}
	{\cal I}(x)=a_{11}\left(\frac{2x}{c}\right)
	\label{eqn:XXX_24}
\end{equation}
となり，時間軸補正を行わない場合の開口合成法と一致する．
${\cal I}(x)$は，入射場$u^{in}(x,t)$と観測波形$a_{11}(t)$の相関
を使って像合成を行うもので一見開口合成法とは無関係に思われる．
式(\ref{eqn:XXX_I_at})は，反射場を観測波形で表した場合の表現で，
観測波形$a(t)$を時間軸を遡る方向へ場を外挿して反射場を推定している
ことに相当する．式(\ref{eqn:XXX_24})では，これに加えて入射波形
をデルタ関数で近似している．これにより，観測波形をどのように
サンプリングして像合成が行われるかが決まり，結果として開口合成法の
画像化関数が得られている．これらのことから,開口合成法が${\cal I}(x)$の
特別なケースであることが分かる．
時間軸原点の補正を伴う開口合成法は,補正量を$t_d$とすれば,
$u^{in}(x,t)=\delta(t+t_d)$とみなすだけで,時間反転法から画像化関数を
導出することができる．また，参照波形を使ったデコンボリューションに
よって観測波形を事前に処理する場合も，以下のようにして時間反転法
の形式に表現することができる．

式(\ref{eqn:XXX_at_dcnv})を用いた開口合成像は
\begin{equation}
	I(x)=\left< \delta\left(t-\frac{2x}{c}\right), \tilde a_{11}(t) \right>
	\label{eqn:XXX_25}
\end{equation}
と表すことができる．右辺の内積は，パーセバルの等式より，周波数領域において
\begin{eqnarray}
	I(x) &=&
	\frac{1}{2\pi}\left< e^{2ikx}, \frac{A}{A_0e^{2ikL_0}} \right> \\
	&=&
	\frac{1}{2\pi}\left< \frac{e^{2ik(x2L_0)}}{(A_0)^*}, A \right> 
	\label{eqn:XXX_26}
\end{eqnarray}
と表される．これを再び時間領域の表現に戻せば，
\begin{equation}
	I(x)= 
	\left< 
	{\cal F}^{-1}\left\{ \frac{e^{-2ikL_0}}{A_0^*}\right\} *\delta \left( t-\frac{2x}{c}\right), 
	a_{11}(t) \right>
	\label{eqn:XXX_Ix_dcnv}
\end{equation}
より，式(\ref{eqn:XXX_I_at})と同じ形式になる．
ただしこの場合，入射場$u^{in}(x,t)$をデルタ関数そのものでなく，
\begin{equation}
	u^{in}(x,t) \leftarrow
	{\cal F}^{-1}\left\{ \frac{e^{-2ikL_0}}{A_0^*}\right\} *\delta \left( t-\frac{x}{c}\right)
	\label{eqn:}
\end{equation}
にとる点が異なっている．ただしこれは，より正確な入射場のモデルを
用いることを意図した置き換えではない．
デコンボリューションの目的は，時間領域でのパルス圧縮にある．
従って，参照波形を利用し，観測波形の位相を揃えるとともに，有効な
周波数帯域をできるだけ拡張することを目的として、サンプリング方法
を定める役割を果たす$u^{in}(x,t)$の場を選んでいるという言い方が
実情にあう．
%なお，実際にデコンボリューション$(A_0^*)^{-1}$を
%評価する際には，周波数フィルターを用いてゼロ割を回避する必要がある． 
%%%%%
\subsubsection{多次元問題}
\paragraph{時間軸補正}
多次元問題に対する開口合成像は式(\ref{eqn:XXX_saft})で与えられる．
従って，時間軸の原点位置を補正したときの画像化関数は
\begin{equation}
	I(\fat{x})=\sum a_{ij}(t_{ij}+t_d(i,j))w_{ij}
	\label{eqn:XXX_27}
\end{equation}
となる．なお，時間軸原点の補正量$t_d$は，送受信子の組み合わせによって
異なることが考えられるため，$t_d=t_d(i,j)$と送受信点番号$(i,j)$に
依存することを明示している．
\paragraph{デコンボリューション}
多次元問題では，複数の観測波形$\{ a_{ij}(t)\}$に対し，個別あるいは共通の
参照波形を用いてデコンボリューションを行う．ここでは，
既知の点散乱体からの散乱波形$\{a^{ref}_{ij}(t)\}$が与えられたとする．
ただし，$i$と$j$はここでも送信および受信位置を表すインデックスとする．
これら参照波形の時間に関するフーリエ変換を
\begin{equation}
	A_{ij}^{ref} ={\cal F} \left\{ a^{ref}_{ij}(t)\right\}
	\label{eqn:XXX_Aij0}
\end{equation}
とする．デコンボリューションは，これらの参照波形を用いて個々の観測波形
について行えばよく，1次元問題の場合と同様にして考えれば，
\begin{equation}
	\tilde a_{ij}(t) = {\cal F}^{-1} 
	\left\{
		\frac{A_{ij}}{A_{ij}^{ref}}e^{ik(L_i+L_j)}
	\right\}
	\label{eqn:XXX_28}
\end{equation}
を計算すればよいことが分かる．ただし，$L_i$は，点$\fat{x}_i$から
参照波形の観測に用いた点散乱体までの距離を表す．
一次元問題では観測点と壁面を往復する際の距離が$2L_0$であったが，
式(\ref{eqn:XXX_28})では，入射波と散乱波の伝播距離が異なる場合もあるため
$L_i+L_j$となっていることが，1次元問題との違いである．
%
\paragraph{時間反転法}
位置$\fat{x}_i$に置かれた送信子からの入射波を$u^{in}(\fat{x},t;\fat{x}_i)$，
それに対して生じる散乱波を$u^{sc}(\fat{x},t;\fat{x}_i)$と表す．
これらの場を用いて，時間反転法における画像化関数を次のように定義する．
\begin{equation}
	{\cal I}(\fat{x})
		=
	\sum_{i}
	\left<
		u^{in}(\fat{x},t;\fat{x}_i), u^{sc}(\fat{x},t;\fat{x}_i)
	\right>
	\label{eqn:XXX_Ix_trev}
\end{equation}
以下では，開口合成法における画像化関数$I(\fat{x})$が，${\cal I}(\fat{x})$の
特別な場合として得られることを示す．\\
%

式(\ref{eqn:XXX_Ix_trev})において，入射場$u^{in}(\fat{x},t;\fat{x}_i)$は既知と
考えてよい．そのため，画像化関数${\cal I}(\fat{x})$を評価する上での問題は，
媒体内部の散乱場$u^{sc}(\fat{x},t;\fat{x}_i)$を，観測波形$a_{ij}(t)$を使って
どのように表現するかということにある．ここでは，散乱場の積分表現を用いて
式(\ref{eqn:XXX_Ix_trev})をより具体的な形で書くこ． 
そのために，媒体表面で入射波の励起と散乱波の観測を行う状況を考える．
いま，媒体が占める領域を$B$，その表面を$\partial B$とし，欠陥が占める領域とその
表面はこれまで通り$D$および$\partial D$でそれぞれを表す．
なお，$B$は欠陥が存在しない場合の媒体を，$B\setminus \bar{D}$は内部に欠陥を
含む媒体を表すことに注意する．全ての観測点$\cal M$は$\partial B$上にとり，
入射波の励起も境界上の領域$S\subset \partial B$から行うとする．
そこで，次のようなノイマン条件を課す．
\begin{equation}
	\frac{\partial u(\fat{x},t)}{\partial n}
	=\left\{
		\begin{array}{cc}
			\bar{q}(\fat{x},t) & (\fat{x}\in S,\, t>0) \\
			0, & {\rm otherwise} 
		\end{array}
	\right.
	\label{eqn:XXX_BC_trev}
\end{equation}
ここで，$\bar{q}(\fat{x},t)$は$S$において指定された既知のノイマン量を表す．
このとき，全波動場$u(\fat{x},t)$は，波動方程式
\begin{equation}
	\nabla^2_x u(\fat{x},t)
	-
	\frac{1}{c^2}\ddot{u}(\fat{x},t)
	=
	0
	, \ \ (\fat{x} \in B\setminus \bar D \times (0,\infty))
	\label{eqn:XXX_wveq_tot}
\end{equation}
に加え，式(\ref{eqn:XXX_BC_trev})に加え，適当な初期条件を満足する．
入射場$u^{in}(\fat{x},t)$は，欠陥が存在しないときの波動場であるため，
これらの式におい$D=\phi$としたものが，支配方程式系となる．
散乱場は全波動場と入射場の差として$u^{sc}=u-u^{in}$で与えられ，
$u^{sc}$自身も，波動方程式(\ref{eqn:XXX_wveq_tot})を満足する．
ここで，全空間のグリーン関数$G(\fat{x},\fat{y},t)$を，
次のような特異解として定義する．
\begin{equation}
	\nabla^2_x G(\fat{x},\fat{y},t)
	-
	\frac{1}{c^2}\ddot{G}(\fat{x},\fat{y},t)
	=
	-4\pi \delta(\fat{x}-\fat{y})\delta(t)
	\label{eqn:XXX_Green_pm}
\end{equation}
グリーン関数は次のように与えられることが知られている．
\begin{equation}
	G(\fat{x},\fat{y},t)=G^{\pm}(\fat{x},\fat{y},t)
	=\frac{1}{r}\delta \left(t\pm \frac{r}{c}\right), 
	\ \ 
	(r=|\fat{x}-\fat{y}|)
	\label{eqn:XXX_Green_pm}
\end{equation}
ここで，$G^+(\fat{x},\fat{y},t)$と$G^-(\fat{x},\fat{y},t)$はそれぞれ因果的，
および非因果的なグリーン関数を表す．以下では，$G^+(\fat{x},\fat{y},t)$と
$G^-(\fat{x},\fat{y},t)$の区別を必要としない場合は$G(\fat{x},\fat{y},t)$
と書く．境界条件(\ref{eqn:XXX_BC_trev})を考慮し，グリーン関数を用いて
全波動場と入射場の積分表現を書けば，それぞれ
\begin{equation}
	u(\fat{x},t) 
	=
	\int_S G(\fat{x},\fat{y},t) * \bar{q}(\fat{x},t)dS_x 
	-
	\int_{\partial D \cup \partial B} H(\fat{x},\fat{y},t) * u(\fat{x},t)dS_x 
	\label{eqn:XXX_utot_int}
\end{equation}
および
\begin{equation}
	u^{in}(\fat{x},t) 
	=
	\int_S G(\fat{x},\fat{y},t) * \bar{q}(\fat{x},t)dS_x 
	-
	\int_{\partial B} H(\fat{x},\fat{y},t) * u^{in}(\fat{x},t)dS_x 
	\label{eqn:XXX_uin_int}
\end{equation}
が得られる．ただし，$H(\fat{x},\fat{y},t)$は
\begin{equation}
	H(\fat{x},\fat{y},t)
	=
	H^{\pm}(\fat{x},\fat{y},t)
	=
	\frac{\partial G^\pm(\fat{x},\fat{y},t)}{\partial n_x}
	\label{eqn:XXX_def_H}
\end{equation}
で，$\pm$が因果的であるかを否かを表すことは$G^{\pm}(\fat{x},\fat{y},t)$
の場合と同様である．
式(\ref{eqn:XXX_utot_int})と(\ref{eqn:XXX_uin_int})の辺々を引くことで，
散乱場の積分表現が次のように得られる．
\begin{equation}
	u^{sc}(\fat{x},t) 
	=
	-
	\int_{\partial B} H(\fat{x},\fat{y},t) * u^{sc}(\fat{x},t)dS_x 
	-
	\int_{\partial D} H(\fat{x},\fat{y},t) * u(\fat{x},t)dS_x 
	\label{eqn:XXX_usc_int}
\end{equation}
式(\ref{eqn:XXX_usc_int})は，$H^{\pm}(\fat{x},\fat{y},t)$のいずれに
対しても厳密に成り立つ表現である．
しかしながら，欠陥$D$と$\partial D$上の場が未知である以上，右辺第二項を
計算することはできない．特に，因果的なグリーン関数$H^+(\fat{x},\fat{y},t)$
を用いる場合，散乱波の発生源は$\partial D$であるため，
この項が計算できない以上，散乱場の評価として意味のある結果は得られない．
一方，$H^-(\fat{x},\fat{y},t)$を用いるときには，時間を遡る方向に
影響が及ぶため，境界$\partial B$における$u^{sc}(\fat{x},\fat{y},t)$
の原因となる過去の時間における散乱場の様子を，計算可能な式(\ref{})
式()右辺第一項は，境界変位の原因となる媒体内部の過去の散乱場を与え，
右辺第二項は、散乱波を励起する原因となった場を再構成する役割を果たす．
従って，第二項を無視したとしても，表面$\partial B$で観測された
散乱波が媒体内部でどのように伝播したかを調べることができる．そこで，
第二項を無視し，
\begin{equation}
	u^{sc}(\fat{x},t) 
	=
	-
	\int_{\partial B} H^-(\fat{x},\fat{y},t) * u^{sc}(\fat{x},t)dS_x 
	\label{eqn:XXX_usc_trev}
\end{equation}
として，用いれば，既知の境界における場の量だけが含まれる式となる．
勿論，(\ref{eqn:XXX_usc_trev})は，欠陥の存在を無視しているため，
この式が与える散乱場は，$\partial B$において捉えることのできる散乱場
の原因となった一部の散乱場であり，また，それが$\partial D$と相互作用
する時間,までしか正しい結果を与えることができない．
欠陥位置は未知であるため，どの時空間領域において正確な再構成結果を
与えるかを判断することはできない．

式(\ref{eqn:XXX_usc_int2})を使って入射場と散乱場の時間に関する内積
を書くと，
\begin{equation}
	\left<
		u^{in}(\fat{x},t),\, 
		u^{sc}(\fat{x},t)
	\right>
	=-
	\left<
		u^{in}(\fat{x},t),\, 
		\int_{\partial B} 
		H^{-}(\fat{y},\fat{x},t)*u^{sc}(\fat{y},t)
	dS_y
	\right>
	\label{eqn:}
\end{equation}
となる．これを，式(\ref{eqn:XXX_Ix_trev})に用いれば，
\begin{eqnarray}
	{\cal I}(\fat{x})
	 &=&
	\sum_{i}
	\left<
		u^{in}(\fat{x},t;\fat{x}_i),\, 
		u^{sc}(\fat{x},t;\fat{x}_i)
	\right>
	\\	
	&=&-
	\sum_{i}
	\left<
		u^{in}(\fat{x},t;\fat{x}_i),\, 
		\int_{\partial B} 
		H^{-}(\fat{y},\fat{x})*u^{sc}(\fat{y},t;\fat{x}_i)
		dS_y
	\right>
	\label{eqn:}
\end{eqnarray}
が得られる．さらに，$\fat{y}$に関する積分を，観測点$\fat{x}_j$
における量で離散化し
\begin{eqnarray}
	{\cal I}(\fat{x})
	&\simeq&
	-
	\sum_{i,j}
	\left<
		u^{in}(\fat{x},t;\fat{x}_i),\, 
		H^{-}(\fat{x}_j,\fat{x})*u^{sc}(\fat{x}_j,t;\fat{x}_i)
	\right>
	\Delta S_i 
	\label{eqn:XXX_Ix_dscrt}
\end{eqnarray}
と表す．次に，$G^{-}(\fat{x},\fat{y},t)$を微分して$H^{-}(\fat{x},\fat{y},t)$
を具体的に計算すれば，
\begin{equation}
	H^-(\fat{x},\fat{y},t)
	=
	\frac{\partial G^-(\fat{x},\fat{y},t)}{\partial n_x}
	=
	\frac{\fat{n}\cdot \hat{\fat{r}}}{cr}
	\left\{
		\delta'\left(t+\frac{r}{c}\right)
		-\frac{c}{r}
		\delta\left(t+\frac{r}{c}\right)
	\right\}
	\label{eqn:XXX_Hm_explicit}
\end{equation}
である．ただし，$\hat{\fat{r}}=\frac{\fat{r}}{r}$を表す．
従って，$r^{-2}$の項を無視すれば，
\begin{equation}
	H^{-}(\fat{x},\fat{y},t)*u^{sc}(\fat{x},t)
	\simeq 
	-\frac{\fat{n}\cdot \hat{\fat{r}}}{cr}
	\dot{u}^{sc}\left(\fat{x},t+\frac{r}{c}\right)
	\label{eqn:}
\end{equation}
と近似できる．これを，式(\ref{eqn:XXX_Ix_dscrt})に用いれば，
\begin{equation}
	{\cal I}(\fat{x})
	\simeq 
	\sum_{i,j}
	\frac{\fat{n}\cdot\hat{\fat{r}}_j}{cr_j}
	\left<
		u^{in}(\fat{x},t;\fat{x}_i),\, 
		\dot{u}^{sc}\left(\fat{x}_j,t+\frac{r_j}{c};\fat{x}_i\right)
	\right>
	\Delta S_i 
	\label{eqn:}
\end{equation}
となる．ただし，$r_j=|\fat{x}_j-\fat{x}|$とした．
最後に，入射場と境界$\partial B$上での散乱場を
\begin{equation}
	u^{in}(\fat{x},t;\fat{x}_i) = G^+(\fat{x},\fat{x}_i,t), \ \ 
	\dot{u}^{sc}(\fat{x}_j,t;x_i)=a_{ij}(t)
	\label{eqn:}
\end{equation}
と，グリーン関数と観測波形でそれぞれ与えれば，画像化関数は
\begin{eqnarray}
	{\cal I}(\fat{x})
	&\simeq & 
	\sum_{i,j}
	\frac{\fat{n}\cdot\hat{\fat{r}}_j}{cr_j}
	\left<
		\frac{1}{r_i}\delta\left( t-\frac{r_i}{c}\right)
		,\, 
		a\left(t+\frac{r_j}{c}\right)
	\right>
	\Delta S_i \\ 
	&=&
	\sum_{i,j}
	a\left(\frac{r_i+r_j}{c}\right)
	\frac{\fat{n}\cdot\hat{\fat{r}}_j}{cr_i r_j} 
	\Delta S_i 
	\label{eqn:XXX_Ix_saft}
\end{eqnarray}
となる．式(\ref{eqn:XXX_Ix_saft})で,
\begin{equation}
	w_{ij}(\fat{x})=\frac{\fat{n}\cdot\hat{\fat{r}}_j}{cr_i r_j} 
	\label{eqn:}
\end{equation}
とすれば，開口合成法の画像化関数に帰着される．
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{開口合成法の一般化}
これまでにみたように，開口合成法は時間反転法の特殊なケースと見ることが
できる．しかしながら，時間反転法の画像化関数自体が，根拠無くから開口合成
\begin{equation}
	I(\fat{x})=\sum_{i,j} a_{ij}(t_{ij})w_{ij}, \ \ t_{ij}=\frac{r_i+r_j}{c}
	\label{eqn:}
\end{equation}
$t_i(\fat{x})=r_i(\fat{x})/c$
\begin{eqnarray}
	I(\fat{x}) &=&
	\sum_{i,j} 
	\left< \delta\left(t-t_i(\fat{x})\right),\, a_{ij}(t+t_j(\fat{x})) \right> w_{ij}
	\\ 
	&=& 
	\sum_{i,j} 
	\left< \delta\left(t-t_i(\fat{x})\right),\, \delta(t+t_j(\fat{x}))*a_{ij}(t) \right>w_{ij}
	\label{eqn:}
\end{eqnarray}
$w_{ij}=\frac{\xi_{ij}}{r_ir_j}$
\begin{equation}
	I(\fat{x}) =
	\sum_{i,j} 
	\left< G^+(\fat{x},\fat{x}_i,t),\, G^{-}(\fat{x},\fat{x}_j,t)*a_{ij}(t)\right>
	\xi_{ij}
	\label{eqn:}
\end{equation}
\begin{equation}
	{\cal F}\left\{ G^{\pm}\right\}(\fat{x},\fat{y},t)=\tilde G(\fat{x},\fat{y},\omega)
	, \ \ 
	{\cal F}\left\{ a_{ij}(t)\right\} =A_{ij}(\omega)
	\label{eqn:}
\end{equation}
\begin{equation}
	A_{ij}=S_i^*(\omega)R_j(\omega)
	I(\fat{x}) =
	\frac{1}{2\pi} \sum_{i,j} 
	\left< \tilde{G}^+(\fat{x},\fat{x}_i,\omega),\, 
	\tilde{G}^-(\fat{x},\fat{x}_j,\omega)*A_{ij}(\omega)\right>
	=
	\frac{1}{2\pi} \sum_{i,j} 
	\left< S(\omega)\tilde{G}^+(\fat{x},\fat{x}_i,\omega),\, 
	\tilde{G}^-(\fat{x},\fat{x}_j,\omega)*A_{ij}(\omega)\right>
	\label{eqn:}
\end{equation}
\begin{equation}
	\label{eqn:}
\end{equation}
\input{adj.tex}
\input{poffis.tex}
\end{document}

