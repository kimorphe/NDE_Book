%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setcounter{section}{3}
\section{問題設定}
物体中に存在するき裂や空洞などの形状を，観測で得た超音波エコー波形から再構成する
問題を考える．形状再構成を行った結果は，画像として表示することを前提とする
ため，以下では形状再構成を行うことと，画像化を同じ意味で用いる．
本節では，開講合成法を中心に，画像合成の原理をできるだけ簡単な状況設定で導入及び
考察する．そのために，図\ref{fig:XXX_arrayM}のような，無限領域内部に存在する
欠陥の画像化(形状再構成)について議論する．媒体は均質な等方線形弾性体で，
超音波をスカラー波とみなす．以下，欠陥が占める領域を$D$，その境界を$\partial D$と表し，
観測波形から$D$や$\partial D$を推定することが画像化の目的となる．\\

スカラー波の送受信は，指定された観測面内にとった$M$個の点:
\begin{equation}
	{\cal M} =\left\{ 
		\fat{y}_1, \fat{y}_2, \cdots \fat{y}_M
	\right\}
	\label{eqn:XXX_00}
\end{equation}
のいずれか，あるいは全ての位置に置かれた理想的な送受信子で行う．
ここで，"理想的"とは次のことを意味する．
\begin{itemize}
\item
送受信子の大きさは波長に比べて小さく点波源，あるいは，点レシーバーとみなすことができる．
\item
送受信子の応答特性が既知，すなわち，指向性や周波数応答特性が知られている．
\item
送受信子は入射波や散乱波動場を乱さない．すなわち，媒体中に発生する
波動場は送受信子と干渉せず，同一点で送信と受信を行うことも可能とする．
\end{itemize}
いま, 位置$\fat{y}_i$にある送信子から入射波を励起し，位置$\fat{y}_j$にある受信子で
波動場を観測したとする．このとき得られるAスキャン波形を$a_{ij}(t)$と表す．
超音波イメージングには，通常，多点計測で得られた複数のAスキャン波形を用いる．
そこで，$\cal M$上の送受信子で得られる波形データセットの全体や一部を参照する
方法について定めておく．
はじめに，全ての可能な送受信位置の組み合わせで得られる波形データを
\begin{equation}
	{\cal D} = \left\{ a_{ij}(t) \left| (\fat{y}_i,\fat{y}_j)  \in {\cal M}\times {\cal M} \right.\right\}
	\label{eqn:XXX_full_mat}
\end{equation}
と表すことにする．${\cal D}(M^2)$を得るためにアレイ探触子を用いる場合，
送受信チャンネルを順次切り替えながら，全ての素子の組で波形収録を行うことになる．
このような観測方式はフルマトリクスキャプチャリングと呼ばれ，$\cal M$が占める範囲は
アレイ探触子の物理的な開口に相当する．一方，一つの送信子と受信子を用いて${\cal D}$
を得るには，送受信子位置を順次移動させながら計測を繰り返す．
この場合，$\cal M$は一連の計測でカバーされる開口(合成開口)を表し，
このような走査方式は機械的走査と呼ばれる．物理的な波形収録方法がいずれであれ，
結果として同じ波形データセットが与えられるならば，画像化の結果に違いは生じない．
このことから，以下では物理的観測方法や，アレイセンサーの開口と合成開口の区別を
断ることはしない．

$\cal M$上で多点計測を行う場合，必ずしも全ての可能な位置の組み合わせで波形収録を
行うとは限らない．その場合，得られる波形データの集合は一般に${\cal D}({\cal M}^2)$の一部である．そこで，
送受信位置の組み合わせ，すなわち観測点配置を
\begin{equation}
	{\cal A}\subset {\cal M}\times {\cal M}
	\label{eqn:XXX_apt}
\end{equation}
とし，${\cal A}$上で得られる波形データセットを
\begin{equation}
	{\cal D}\left({\cal A} \right) 
	= 
	\left\{ a_{ij}(t) \left| (\fat{y}_i,\fat{y}_j)  \in {\cal A}\right.\right\}
	\label{eqn:XXX_DA}
\end{equation}
と表す．例えば，一つの探触子で送受信を行うパルスエコー法によって$\cal M$を走査して
得られるデータは
\begin{equation}
	{\cal A}=\left\{ 
	(\fat{y}_i,\fat{y}_i)
	\left|
		i=1,\cdots M
	\right.
	\right\}
	\label{eqn:XXX_pecho}
\end{equation}
としたときの${\cal D}({\cal A})$である．

以下では，観測点配置$\cal A$を指定したときに与えられるデータ${\cal D}({\cal A})$から，
散乱体$D$の形状を再構成して画像化する方法について考える．その際，画像化を行う領域を$A$，
画像化点を$\fat{x}$とし，$\fat{x}$における画素値を$I(\fat{x})$と表す．
画像化関数$I(x)$は領域$A$で定義されるスカラー関数で，その値が取りうる範囲や意味は
画像化手法によって異なる．
\begin{figure}[h]
	\begin{center}
	\includegraphics[width=0.6\linewidth]{Figs/measurement.pdf} 
	\end{center}
	\caption{送受信アレイ$\cal M$，散乱体$D$，および画像化領域$A$.} 
	\label{fig:XXX_arrayM}
\end{figure}
%
\section{開口合成法}
\subsection{再構成式}
開口合成法では次のような波形の重ね合わせで欠陥の画像を合成する．
\begin{equation}
	I(\fat{x})=\sum_{\cal D}a_{ij}(t_{ij}(\fat{x}))w_{ij}(\fat{x})
	\label{eqn:XXX_saft}
\end{equation}
ここで，$\sum_{\cal D}(\cdot)$は，データ$\cal D$に関する和を表し，
正確には
\begin{equation}
	\sum_{\cal D} 
	(\cdot)
	=
	\sum_{\cal D(A)}
	(\cdot)
	=
	\sum_{(\fat{y}_i,\fat{y}_j)\in{\cal A}}
	(\cdot)
	\label{eqn:XXX_sum_D}
\end{equation}
を意味する．従って，${\cal A}= {\cal M}\times{\cal M}$ならばインデックス$i,j$に関する二重和を，
式(\ref{eqn:XXX_pecho})のような観測点配置であれば$i(=j)$に関する和を表す．
式(\ref{eqn:XXX_saft})におけるサンプリング時間$t_{ij}$は，送信点$\fat{y}_i$から入射された波が，
画像化点$\fat{x}$を経て観測点$\fat{y}_j$に至るまでに要する時間を表す．
高周波近似が成り立つと仮定すれば，均質媒体における波動伝播経路を直線と考えて良い．
そこで，媒体の位相速度を$c$とすれば，$t_{ij}(\fat{x})$を次のように書くことができる．
\begin{equation}
	t_{ij}(\fat{x})=\frac{r_i(\fat{x})+r_j(\fat{x})}{c}, \ \ r_i:=\left| \fat{x} -\fat{y}_i\right|
	\label{eqn:XXX_tij}
\end{equation}
最後に，式(\ref{eqn:XXX_saft})の$w_{ij}(\fat{x})$は，Aスコープ波形を重ね合わせる際の重みを表す．
例えば，送受信センサーの指向性や感度，波動場の材料減衰や幾何減衰を補正するために調整できる項である．

式(\ref{eqn:XXX_saft})は発見的に与えられたもので，この段階では画像$I(\fat{x})$が何を表し，
どのような原理に基づいて像合成が行われるか明らかでない．
そこで，以下において，$I(\fat{x})$が点散乱体の強度とみなせることを述べ，
次に，開口合成法がどのように機能するかを簡単な数値実験を通して調べる．
%また，どのような計測条件が画像化上有利であるかも，
%数値実験を通じてかなりの程度調べられる．さらに，開口合成法は，画像化関数のアドホックな改善や拡張と，
%画像化アルゴリズムの実装が極めて簡単であることが利点である．
%例えば，送受信センサーの指向性や距離減衰，入射波や散乱波の反射やモード変換を計測条件に応じて
%考慮することも(そのやり方が妥当かどうかの検証はさておき)簡単である．
さらに，次節と次々節では，随伴方程式法と線形化逆散乱解析による画像化方法と開講合成法
が関係付けられることを見ることにより，開口合成法の理論的な基礎を与える．
%なお，開口合成法の再構成式(\ref{eqn:XXX_saft})は，後に述べるように線形化逆散乱解析法や
%随伴方程式法の結果を単純化することで導出できることをみる．
%開口合成法の画像化関数$I(\fat{x})$の意味はその結果として明らかになる．
\subsection{基本的な考え方}
大きさをもった散乱体$D$を，点散乱体の集まりとみなして散乱問題と画像化問題を
を考えてみる．例えば，き裂や空洞，剛体介在物では領域の表面で散乱がおきるため，
散乱体をその境界$\partial D$上に稠密に配置された点散乱体群とみなす．一方，
介在物の場合，領域内部に入射波の一部が透過するため，$D$全体に渡って点散乱体が
配置されたモデルを考える．以下に述べるように，開口合成法はこれら点散乱体の
位置と強度を画像化する方法と解釈することができる．
\begin{figure}[h]
	\begin{center}
	\includegraphics[width=0.5\linewidth]{Figs/cloud.pdf} 
	\end{center}
	\caption{点散乱体群による散乱体の表現(イメージ).} 
	\label{fig:XXX_cloud}
\end{figure}
ここで，点散乱体とは，大きさの無視できる理想化された散乱体を意味し，入射波振幅
に比例した強度の点源として振る舞うものである．その比例係数を$s$とし，これを
散乱強度と呼べば，位置$\fat{z}$にある点散乱体は，入射波$u^{in}(\fat{x},t)$に
よって励起される点源項としして扱うことができる．スカラー波動場の場合，それは
支配波動方程式における次のようなソース項として表される．
\begin{equation}
	4\pi s\delta (\fat{x}-\fat{z})u^{in}(\fat{z},t)
	\label{eqn:XXX_psct}
\end{equation}
ただし，式(\ref{eqn:XXX_psct})において$s$は定数としており，これは散乱による
位相遅れや波形変化が無いことを意味している．ただし，入射波と散乱波で位相が
逆転することがある場合は，散乱強度$s$は負の値となることは許容する必要がある．
次に，観測波形と散乱強度を結びつけるために，全波動場を入射場と散乱場の
和として次のように表す．
\begin{equation}
	u(\fat{x},t)=u^{in}(\fat{x},t)+u^{sc}(\fat{x},t)
	\label{eqn:XXX_utot}
\end{equation}
また，全空間のグリーン関数を$G(\fat{x},\fat{y},t)$とすれば，
点散乱体群からの散乱波$u^{sc}(\fat{x},t)$は次のように表すことができる．
\begin{equation}
	u^{sc}(\fat{x},t)=\sum_k s_k G(\fat{x},\fat{z}_k,t)*u^{in}(\fat{z}_k,t)
	\label{eqn:XXX_usc_G}
\end{equation}
ただし，$*$は時間に関する畳み込み積を，$\fat{z}_k$と$s_k$は，
第$k$番目の点散乱体の位置と強度をそれぞれ表す．さらに，入射波は
位置$\fat{y}_i(\in {\cal M})$の点源で励起されるとしているため，
式(\ref{eqn:XXX_usc_G})において$u^{in}(\fat{x},t)=G(\fat{x},\fat{y}_i,t)$とすれば，
次の関係が得られる．
\begin{equation}
	u^{sc}(\fat{x},t;\fat{y}_{i})=\sum_k s_k G(\fat{x},\fat{z}_k,t)*G(\fat{z}_k,\fat{y}_i,t)
	\label{eqn:XXX_usc_GG}
\end{equation}
なお，式(\ref{eqn:XXX_usc_GG})の左辺では，セミコロンの後に$\fat{y}_i$を加え，
位置$\fat{y}_i$からの入射波に起因した散乱波であることを明示するようにしている．
観測で得らるAスキャン波形$a_{ij}(t)$は，$\fat{y}_j$における散乱場だから
\begin{equation}
	a_{ij}(t)
	=u^{sc}(\fat{y}_j,t;\fat{y}_i)
	=\sum_k s_k G(\fat{y}_j,\fat{z}_k,t)*G(\fat{z}_k,\fat{y}_i,t)
	\label{eqn:XXX_aij_GG}
\end{equation}
となる．これをより具体的な表現にするために，3次元スカラー波のグリーン関数:
\begin{equation}
	G(\fat{x},\fat{y},t)=
	\frac{\delta\left(t-\frac{r}{c}\right)}{r}, 
	\ \ (r=\left| \fat{x}-\fat{y}\right|)
	\label{eqn:}
\end{equation}
を用いれば，$a_{ij}(t)$は次のようになる．
\begin{eqnarray}
	a_{ij}(t)
	&=&
	\sum_{k}
	\frac{ s(\fat{z}_k) }{ r_i(k)r_j(k) }
	\delta\left(t-\frac{r_i(k)}{c}\right) * \delta\left( t-\frac{r_j(k)}{c}\right)\\
	\label{eqn:}
	&=&
	\sum_k
	\frac{ s(\fat{z}_k) }{ r_i(k)r_j(k) }
	\delta\left(t-\frac{r_i(k)+r_j(k)}{c}\right) 
	\label{eqn:XXX_aijt}
\end{eqnarray}
ただし，$r_i(k)=\left| \fat{y}_i-\fat{z}_k\right|$とした．

式(\ref{eqn:XXX_aijt})を式(\ref{eqn:XXX_saft})を用いれば，開口合成法における画像化関数を
次のように表すことができる．
\begin{eqnarray}
	I(\fat{x})
	&=&
	\sum_{\cal D}
	\sum_{k}
	\frac{ s(\fat{z}_k)}{r_i(k)r_j(k)}
	\delta\left(t_{ij}(\fat{x})-\frac{r_i(k)+r_j(k)}{c}\right)  w_{ij}
	\\
	&=&
	\sum_{\cal D} \sum_{k}
	\frac{cw_{ij}}{r_i(k)r_j(k)} s(\fat{z}_k)
	\delta\left(r_i(\fat{x})+r_j(\fat{x})-r_i(k)-r_j(k)\right) 
	\label{eqn:XXX_I_model}
\end{eqnarray}
式(\ref{eqn:XXX_I_model})の右辺は，Diracのデルタ関数を使って書かれているため
その値を評価することはできない．そこで，デルタ関数$\delta(s)$を，
分散$\sigma^2$の正規分布:
\begin{equation}
	\delta_\sigma (s) = \frac{1}{ \sqrt{2\pi}\sigma } \exp\left( -\frac{s^2}{2\sigma^2}\right)
	\label{eqn:Gauss}
\end{equation}
で近似する．$\delta_\sigma(s)$は通常の意味での関数であり数値的な評価は容易である．
また，$\sigma\rightarrow 0$の極限においてデルタ関数を与え，パラメータ$\sigma$を小さく
することで必要なだけ近似精度を上げることができる．
最後に，データ$\cal D(A)$に含まれる波形数を$|{\cal A}|$として，
\begin{equation}
	w_{ij}^*
	=
	\sqrt{2\pi}\sigma
	\frac{r_{i}(\fat{x})r_j(\fat{x})}{c\left| {\cal A}\right|}
	\label{eqn:wij_model}
\end{equation}
とし，これを開口合成法の重みとして用いれば，画像化関数が$\sigma$に応じた精度で
\begin{equation}
	I(\fat{x})
		\simeq 
	I_\sigma(\fat{x})
		:=
	\sum_{\cal D} \sum_{k}
	\frac{w_{ij}^*s_k}{r_i(k)r_j(k)} 
	\delta_\sigma\left(r_i(\fat{x})+r_j(\fat{x})-r_i(k)-r_j(k)\right) 
	\label{eqn:XXX_saft_model}
\end{equation}
と近似できる．このようにして得られた$I_\sigma(\fat{x})$は散乱体位置$\fat{z}_k$において
\begin{equation}
	I_\sigma(\fat{z}_k)=s_k
	\label{eqn:}
\end{equation}
と散乱体強度に一致することが確かめられる．これは，開口合成法が点散乱体の
強度分布を推定する方法であることを示している．
ただし点散乱体の位置を推定できるような画像を得るためには，$\fat{x}\neq \fat{z}_k$
では$I_\sigma(\fat{x})$は$s_k$に比べて小さな値を取る必要がある．
そこで，$I_\sigma(\fat{x})$がどのような位置で大きな値をとるかを考えてみる．
このとき，$\sigma$は十分小さいとすれば，$\delta_\sigma(s)$は$|s|\rightarrow \infty$で
急速に減少する．このことから，
$\delta_\sigma\left(r_i(\fat{x})+r_j(\fat{x})-r_i(k)-r_j(k)\right)$が有意な値を取るのは
\begin{equation}
	r_i(\fat{x})+r_j(\fat{x})=r_i(k)+r_j(k)
	\label{eqn:XXX_cntr}
\end{equation}
となる$\fat{x}$のごく近傍に限られる．
式(\ref{eqn:XXX_cntr})は，$(i,j)$すなわち送受信点の組に対し，3次元問題では一つの曲面を，
2次元問題では曲線を定義する．これら，式(\ref{eqn:XXX_cntr})が定める曲線あるいは曲面を
$\Gamma_{ij}(\fat{z}_k)$とすれば，$I_\sigma(\fat{x})$が大きな値をとるためには，
画像化点$\fat{x}$が，多数の$\Gamma_{ij}(\fat{z}_k)$の共通部分に属する必要がある．
従って，$\cal A$が定める曲面群(曲線群):
\begin{equation}
	\left\{ \Gamma_{ij}(\fat{z})\left|  (i,j)\in {\cal A} ,\,\, \fat{z} \in A \right.\right\}
	\label{eqn:XXX_Crvs}
\end{equation}
が任意の$\fat{z}\in A$に対して，$\fat{x}=\fat{z}$以外の位置で共通部分を持たないようにすることができれば，
正確に点散乱体の位置と強度を推定できることが分かる．
$\cal A$をどのように選択すればこの条件が満足されるか，一般的な状況で調べることは難しい．
そこで，以下では簡単な数値実験を行い，送受信点配置$\cal A$に応じてどのような開口合成像が
得られるかを調べる．
$\Gamma_{ij}$は，$(\fat{y}_i,\fat{y}_j)$の送受信点で観測されるインパルス波形が，
開口合成法による画像化において投影される位置を表す．このことを踏まえ，以下では
$\Gamma_{ij}$をエコー投影曲面あるいはエコー投影曲線と呼ぶ．
$\Gamma_{ij}$は球(円)あるいはだ円体(だ円)になることが容易に示される．
\subsection{単一点散乱体の開口合成像}
大きさをもった散乱体を点散乱体群がどの程度よく近似できるかという問題はさておき，
少なくとも，単一の点散乱体の形状再構成は満足のいく精度でできることが期待される．
そこで，座標原点$\fat{o}$にある無指向性の単一点散乱体を，2次元開口合成法で画像化する
問題を考える．この場合，点散乱体を識別する番号は$k=1$のみだから，$k$に関する和をとる必要は無く，
散乱体位置$\fat{z}_k$や強度$s_k$のインデックス$k$を省略しても
混乱は無い．そこで，式(\ref{eqn:XXX_saft_model})を
\begin{equation}
	I_\sigma(\fat{x})
		=
	\sum_{\cal D} 
	\frac{w_{ij}^*s}{r_i(\fat{z})r_j(\fat{z})} 
	\delta_\sigma\left(r_i(\fat{x})+r_j(\fat{x})-r_i(\fat{z})-r_j(\fat{z})\right) 
	\label{eqn:XXX_saft_model_k1}
\end{equation}
と書き直す．式(\ref{eqn:XXX_saft_model_k1})の右辺は，$\fat{z}$や$s$を具体的に
与えれば実際に計算することができ，$I_\sigma(\fat{x})$の値は，エコー投影曲線
(\ref{eqn:XXX_Crvs})の配置によって概ね決定される．具体的には，多数の曲線が
交差する箇所で大きな値をとり，少数の曲線が通る，あるいは曲線が通らない箇所は小さな値になる．
従って，$\Gamma_{ij}(\fat{z}$の交差状況を見ることで，開口合成法がどのように像合成を
行うかかなりの程度理解できる．そこで，送受信点配置$\cal A$を与え，
簡単なケースで曲線群(\ref{eqn:XXX_Crvs})を描画してみる．
%なお，観測に用いる送受信子は無指向性かつ周波数帯域が十分広く，デルタ関数を含め
%任意の波形を正確に送受信できる理想化された観測条件を仮定する．
%このような単一点散乱体の開口合成結果を見ることで，開口合成法がどのように機能するかを理解することができる．
\subsubsection{送受信点が一つの場合}
はじめに一箇所で送受信を行った場合($M=1$)について考える．このとき，
\begin{equation}
	{\cal M} =\left\{ 
		\fat{y}_1
	\right\}
	\label{eqn:XXX_M1}
\end{equation}
で，自動的に${\cal A}={(\fat{y}_1,\fat{y}_1)}$となるので，考慮すべき
曲線は$\Gamma_{11}(\fat{z})$のみである．一般の$\Gamma_{ij}(\fat{z})$は
式(\ref{eqn:XXX_cntr})で表されるので，$\Gamma_{11}(\fat{z})$は
$i=j=1$として
\begin{equation}
	\Gamma_{11}(\fat{z}): 
	r_{1}(\fat{x})=r_{1}(\fat{z})=\left| \fat{y}_1-\fat{z} \right|
	\label{eqn:XXX_Gmm11}
\end{equation}
となる．これは中心$\fat{y}_1$，半径$r_1(\fat{z})$の円を表す．
この場合，$I_\sigma(\fat{x})$からは，円弧$\Gamma_{11}(\fat{z})$上
のいずれかの位置に散乱体が存在することまでが推定できる．
\subsubsection{送受信点が二つの場合}
次に2つの送受信位置をとり$M=2$とした場合，すなわち
\begin{equation}
	{\cal M} =\left\{ 
		\fat{y}_1, \fat{y}_2
	\right\}
	\label{eqn:XXX_M2}
\end{equation}
での画像化について考える．このとき，$\Gamma_{ij}=\Gamma_{ji}$だから，
曲線群(\ref{eqn:XXX_Crvs})は3つの要素を持つ．
\begin{equation}
	\left\{ \Gamma_{ij} \right\} = \left\{ \Gamma_{11},\Gamma_{22}, \Gamma_{12}=\Gamma_{21}\right\}
	\label{eqn:}
\end{equation}
このうち，$\Gamma_{ii}, (i=1,2)$は，中心$\fat{y}_i$, 半径$r_i(\fat{z})$の円であることは明らかであろう．
一方$\Gamma_{12}(\fat{z})$は，
\begin{equation}
	\Gamma_{12}(\fat{z}): \, r_1(\fat{x})+r_2(\fat{x})=r_1(\fat{z}) +r_2(\fat{z})
	\label{eqn:}
\end{equation}
だから，$\fat{y}_1$と$\fat{y}_2$を焦点とする楕円を表す．
以上のことを踏まえ，$M=2$の場合の曲線群の配置を示すと図\ref{fig:XXX_locii}のようになる．
この図の(a)は二点$\fat{y}_1$と$\fat{y}_2$が十分離れている場合，(b)は近接している場合に
ついて，示したもので，散乱体位置$\fat{z}$を原点としている．
この場合，２つの円とだ円は全て原点で交わり，このことから，点散乱体が座標原点にあることが読み取れる．
\begin{figure}[h]
	\begin{center}
	\includegraphics[width=0.6\linewidth]{Figs/locii.pdf} 
	\end{center}
	\caption{曲線$\Gamma_{ij}(\fat{z})$の配置．$M=2$，点散乱体位置を原点とした場合.(a)は送受信点が離れている場合,(b)は近接している場合.} 
	\label{fig:XXX_locii}
\end{figure}
%\begin{figure}[h]
%	\begin{center}
%	\includegraphics[width=0.8\linewidth]{Figs/wvfm2.pdf} 
%	\end{center}
%	\caption{2つの送受信子を使った点散乱体からのエコー観測.} 
%	\label{fig:XXX_wvfm2}
%:\end{figure}
これまでの議論では，$\delta_\sigma(s)$において$\sigma$が十分小さいとする
仮定のもと，パルス布を考慮せず$\Gamma_{ij}$の配置だけを見てきた. 
しかしながら，実際に送受信される波形では，パルス幅を自由に任意に小さくすることはできない．
従って，開口合成画像上で，個々の曲線$\Gamma_{ij}$を完全に正確に特定することはできず，
散乱体位置の推定にも曖昧さが残る．このような効果をみるために，
図\ref{fig:XXX_locii}の二つのケースに対応する開口合成像を，
式(\ref{eqn:XXX_saft_model_k1})において適当な$\sigma$与えて合成してみる．
図\ref{fig:XXX_saftM2}はその結果をグレースケールで示したもので，明るい
色で示された箇所が大きな画素値に対応する．
なお，これらの画像の計算では，ガウス関数の拡がりによる影響を見ることを
目的としているため，式(\ref{eqn:XXX_saft_model_k1})において，$\delta_\sigma(s)$
以外の項は1としている．
画素値は，点散乱体の強度に比例する量と考えてよいので，大きな画素値を持つ部分に
散乱体が存在する可能性が高いと解釈できる．
図\ref{fig:XXX_saftM2}(a)では，座標原点位置に明確な画素値のピークが現れており
この場合は点散乱体位置の特定が容易である．一方，(b)の場合，大きな画素値を持つ
領域が拡がっていて，ピーク位置，すなわち，散乱体位置が読み取りにくい．
各画像ピクセルの画素値を一つ一つ調べれば，画像(b)でもピーク位置の特定は可能である．
しかしながら，計測波形を用いて像合成を行う場合，画像(b)のようななだらかな
ピークを示す画像では，計測ノイズの影響でピーク位置の推定結果が大きく変化する
可能性がある．
%さらに言えば，画像化の最終目的が散乱体形状の再構成にあることを考えると，
%合成された画像において”点"乱体は"点"のように再構成されるべきである．
以上から，画像(a)は画像(b)よりも望ましいものと言える．

このように，同数の波形を用いて画像化を行う場合でも，観測点の配置に
よって得られる結果が大きく異なることがある．このことを考えると，どのように
観測点を配置することが画像化上有利なのかという疑問が湧く．
図\ref{fig:XXX_saftM2}の結果によれば，観測点が互いにある程度離れている方が
よいことは明らかである．この理由は次のように説明できる．
はじめに図\ref{fig:XXX_locii}(a)をみると，$\Gamma_{ij}$は散乱体位置(原点)
互いに大きく異なる方向を向いている．一方，同図の(b)では，3つの曲線が
概ね同じ方向を向き，浅い角度で交差している．その結果として(a)では(b)よりも
交点位置が読み取り易くなっている．このことは，$\Gamma_{ij}$の向きが，点散乱体位置$\fat{z}$
において，互いにできるだけ異なる方向を向くことが画像化上望ましいことを意味する．
曲線上の各点における向きは，接線でなく法線ベクトルで表すこともできる．
従って，位置$\fat{z}$にある点散乱体を画像化する上で望ましい条件は，
曲線群(\ref{eqn:XXX_Crvs})の$\fat{z}$における法線ベクトルの向きに
偏りが無いこと，と言い換えることができる．
$\Gamma_{ij}(\fat{z})$の，位置$\fat{z}$における単位法線ベクトルを$\fat{n}_{ij}(\fat{z})$と
すれば，これは次のように与えられる．
\begin{equation}
	\fat{n}_{ij}(\fat{z}) 
	=\frac{\nabla_z \left\{ r_i(\fat{z})+r_j(\fat{z})\right\}}
	{\left| \nabla_z \left\{r_i(\fat{z})+r_j(\fat{z})\right\})\right|}
	=\frac{
		\hat{\fat{r}}_i(\fat{z})+\hat{\fat{r}}_j(\fat{z})
	}{
		\left| \hat{\fat{r}}_i(\fat{z})+\hat{\fat{r}}_j(\fat{z}) \right|
	}
	\label{eqn:XXX_08}
\end{equation}
ただし$\hat{\fat{r}}_i$は次の式で与えられる単位ベクトルを表す．
\begin{equation}
	\hat{\fat{r}}_i(\fat{z}):=
	\frac{\fat{z}-\fat{y}_i}
	{\left| \fat{z} -\fat{y}_i\right|}
	\label{eqn:XXX_ri_hat}
\end{equation}
$i=j$のとき，
\begin{equation}
	\fat{n}_{ii}(\fat{z})=\hat{\fat{r}}_i(\fat{z})
	\label{eqn:}
\end{equation}
で，散乱体位置$\fat{z}$から送受信点$\fat{y}_i$を指す単位ベクトルに一致するという
単純な結果が得られる．このことは，パルスエコーモードで観測を行う場合，
$\fat{n}_{ii}$が各々異なる方向を向くよう，点散乱体位置$\fat{z}$からみて一定間隔の方位
に観測点$\fat{y}_i$を配置することが望ましいことを意味する．
実際の探傷では，散乱体位置は未知であるため，この方針に厳密に従って
観測点を配置することはできない．ただし，送受信点が画像化範囲から十分遠方にある場合，
座標原点を散乱体付近に取ることができれば，近軸近似(paraxial approximation)により，
\begin{equation}
	\hat{\fat{r}}_i(\fat{z}) \simeq \hat{\fat{y}}_i:= \frac{\fat{y}_i}{|\fat{y}_i|}
	, \ \ (|\fat{z}|\ll |\fat{y}_i|)
	\label{eqn:XXX_09}
\end{equation}
と表すことができる．従ってこの場合，法線ベクトルを
\begin{equation}
	\fat{n}_{ij} \simeq  
	\fat{\xi}_{ij}:=
	-\frac{\hat{\fat{y}}_i+\hat{\fat{y}}_j}
	{| \hat{\fat{y}}_i+\hat{\fat{y}}_j|}
	\label{eqn:XXX_10}
\end{equation}
と，散乱体位置$\fat{z}$に依存しない形で表すことができる．
以上より，式\ref{eqn:XXX_10}で与えられるベクトル$\fat{xi}_{ij}$が
互いに異なる方向となるように観測点$\cal A$を配置することが，良好な
開口合成像を得るための一つの指針となる．
逆に言えば，異なる送受信点で得られた二つのAスキャン波形$a_{ij}(t)$と
$a_{i'j'}(t)$があり，もし$\fat{\xi}_{ij}\simeq \fat{\xi}_{i'j'}$
ならば，どちらか一方の波形を使えばよく，両方を用いることによって
散乱体位置特定における解像度の向上は期待できない．
このような状況は頻繁に生じることは，次のような簡単な例で理解することができる．
%このような近似は，$a_{ij}$を，方向$\hat{\fat{y}}_i$から到来する平面波
%で励起された散乱波のうち，方向$\hat{\fat{y}}_j$で観測することに相当する．
%位置$\fat{x}$にある点散乱体を開口合成画像中で正確に特定するためには，
%$\fat{n}_{ij}$の方向が様々に変化するように観測点$\fat{y}_i$が配置されている必要である．
%
%逆に，どの送受信点の組み合わせでも$\fat{n}_{ij}$にあまり大差が無い場合，
%画像中の点散乱体の指示が拡がり，散乱体位置の特定が難しくなる．さらに言えば，
%観測Aと別の観測Bにおいて法線ベクトルが同じ場合，観測Aに加えてBを行うことで
%位置特定の解像度をあげる効果は期待できない．このような状況は頻繁に生じる．

図\ref{fig:XXX_blind_sum}(a)のような状況で$M=2$の観測データ
${\cal D}({\cal M}^2)$を得たとする．
このとき，${\cal D}({\cal M}^2)$の一部
\begin{equation}
	{\cal A}=\left\{ 
		a_{11}(t), a_{22}(t), a_{12}(t) 
	\right\}
	\label{eqn:}
\end{equation}
を用いて，式(\ref{eqn:XXX_saft_model_k1})で開口合成を行うと，
同図(b)の結果が得られる．この場合，散乱体位置である原点での
法線ベクトルは，
\begin{equation}
	\fat{\xi}_{11}=(-\sin\theta,\cos\theta), \,
	\fat{\xi}_{22}=( \sin\theta,\cos\theta), \,
	\fat{\xi}_{12}=(0,1)
	\label{eqn:XXX_11}
\end{equation}
である．従って，画像合成に用いた波形のうち，法線ベクトルが互いに近い
向きにあるものは無い．一方，${\cal D}({\cal M}^2)$全てを使って
像合成を行うと，図\ref{fig:XXX_blind_sum}(c)が得られる．
(b)と(c)では，(c)の方が大きな画素値を持つ範囲がより水平方向により広いことが分かる．
また，曲線$\Gamma_{12}$に対応するだ円が強調されり,(b)よりも多くの波形を使用した
にも関わらず，点散乱体の位置や形状をみるための画像としての改善が見られない．
これは，同じ法線ベクトル$\fat{\xi}_{12}=\fat{\xi}_{21}$をもつ
$a_{12}(t)$と$a_{21}(t)$を同じ重みで加算したことによる．このように，得られた
波形全てを単に足し込むだけで画像の質が向上する訳でなく，
曲線群(\ref{eqn:XXX_Crvs})の法線ベクトル$(\fat{n}_{ij}\simeq \fat{\xi}_{ij})$が
重複無く，広い範囲でサンプリングされるように送受信位置をとることが重要
であることを意味している．
\begin{figure}[h]
	\begin{center}
	\includegraphics[width=.6\linewidth]{Figs/saftM2.pdf} 
	\end{center}
	\caption{開口合成画像の例.(a)送受信点が離れている場合,(b)送受信点が近接している場合.} 
	\label{fig:XXX_saftM2}
\end{figure}
\begin{figure}[h]
	\begin{center}
	\includegraphics[width=0.9\linewidth]{Figs/blind_sum.eps} 
	\end{center}
	\caption{(a)送受信条件と,(b),(c)開口合成像．(b)は$w_{21}=0$の場合, (c)は4つの波形全てを用いた場合.}
	\label{fig:XXX_blind_sum}
\end{figure}
%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{点拡がり関数(point spread function)}
点散乱体が一つだけ存在することが分かっている場合，2点での観測波形から位置特定が
可能であることをみた．一方，合成された画像から，散乱体形状が点であることを知るには，
これまでに示した少数の観測結果からの開口合成が十分でないことは明らかである．そこで，
適切に配置された送受信点を多数とることで，点散乱体の形状をより忠実に表現できること
をみていく．

はじめに，原点におかれた点散乱体に対し，原点を中心とする円を観測面にとる．
この円上を等間隔に$M$個の送受信点を配置する．
これら$M$個の送受信点の$M^2$個の組合わせの中には，エコー投影曲線の法線ベクトルが互いに
一致するあるいは近い方向となるものが多数ある．そこで，法線ベクトルの重複を
避けるため，パルス-エコーモードでの観測データ(式(\ref{eqn:XXX_pecho}))を画像化に用いる．
この場合，$\fat{\xi}_{ii}$は単位円上に等間隔で配置され，互いに一致することがない．
以上の設定で，前節と同様，式(\ref{eqn:XXX_saft_model_k1})によって$I_\sigma(\fat{x})$
を計算する．図\ref{fig:XXX_psf_pulse}はその結果として得られた開口合成像を示したものである．
この図の(a)は，送受信点数を$M=10$とした場合，(b)は$M=20$の結果である．
どちらのケースでも，全周方向から計測を行っているため，原点に集中した
等方的な分布が得られ，点散乱体の画像と呼ぶにふさわしい画像が得られている．
%%%
理想的な画像化システムでは，点散乱体がデルタ関数として再構成される．
現実の画像化システムでは，散乱体近傍に集中した分布が得られたとしても，
完全な点として画像化されることはない．点散乱体を撮像したときに得られる
滲んだ画像，すなわち，画像化システムのデルタ関数入力に対する応答は，
点拡がり関数(PSF:point spread function)と呼ばれる．この定義に従えば，
図\ref{fig:XXX_psf_pulse}は，観測点数を$M=10$あるいは20としたときの
PSFであるということができる．これら二つのPSFは，原点近傍をみる限り
大差がないが，原点から離れたところでは$M=10$の場合に凹凸が目立つ．
図\ref{fig:XXX_psf_profile}は， この様子を詳しくみるために 
$y=0$におけるPSFの断面図を示したものである．
この結果から明らかなように， メインローブは観測点数によらず
ほぼ一致している．
メインローブ幅は，複数の点散乱体があるとき，互いに接近した点散乱体が
画像上で区別できるかどうかの指標となるため，画像化システムの分解能
とみなすことができる．図\ref{fig:XXX_psf_pulse}と図\ref{fig:XXX_psf_profile}
の結果は，観測が全周方向から行われる場合，観測点数を増やしても分解能は
変わらないことを示している． 
一方，メインローブの外側では，観測点数が少ない$M=10$のケースの方が
分布の裾野が広く，わずかにサイドローブも生じている．サイドローブや再度ローブの
干渉によって，実際には存在しない物体の像として認識されることがあり，
偽像と呼ばれる．図\ref{fig:XXX_psf_profile}は，観測点数を増やすことには
偽像の発生を抑える効果があることを示唆している．

次に，観測点間隔を一定に保ち，観測方向が全周から制限されることでどのように画像が劣化するかを
調べる．図\ref{fig:XXX_psf_aptlim}はそのために，観測点の配置間隔を15度で，観測点数を(a)24点とり
全周方向から観測した場合に加え，(b)13点,半周，(c)9点,120度,(d)5点，60度の場合について
PSFを示したものである．いずれのケースでも原点にピークを持つ分布を示しているが，
観測方向が半周に制限された(b)では，画像は上下非対称で，若干鉛直方向に分布幅が広がっている．
また，(c)の場合は，メインローブの形状等方的でなく観測点が配置されて方向と直行する方向に
伸び始める．最も制約の厳しい(d)ではこの傾向が一層顕著で，もはやこの画像から
散乱体が点状のものであるか，小さな平板状のものかを区別することが難しくなる．
なお，全周方向からの計測が可能であることは，超音波探傷試験ではほとんどありえない．
むしろ，(d)のケースのように，観測方向が狭い範囲に限定されることが普通である．
このことを考えると，観測方向の制限による画像劣化の様子を念頭におくことは，
探傷データを使った欠陥評価において重要である．

\begin{figure}[h]
	\begin{center}
	\includegraphics[width=1.0\linewidth]{Figs/psf_pulse.eps} 
	\end{center}
	\caption{全周方向からパルス-エコーモードで送受信したときの開口合成像.(a)$M=10$, (b)$M=20$の場合.} 
	\label{fig:XXX_psf_pulse}
\end{figure}
\begin{figure}[h]
	\begin{center}
	\includegraphics[width=0.6\linewidth]{Figs/psf_profile.eps} 
	\end{center}
	\caption{$y=0$における開口合成像の断面図. 観測点数(a)$M=10$, (b)$M=20$.}
	\label{fig:XXX_psf_profile} 
\end{figure}
\begin{figure}[h]
	\begin{center}
	\includegraphics[width=0.9\linewidth]{Figs/psf_aptlim.eps} 
	\end{center}
	\caption{開口を制限したときの点散乱体の開口合成像(送受信点の配置間隔は15度，観測点数数と観測範囲は
	(a)24点,360度, (b)13点,180度, (c)9点,120度, (d)5点.60度.} 
	\label{fig:XXX_100}
\end{figure}
ここまでの議論では，任意の形状と幅のパルス波を送受信できることを前提としてきた．
一方，実際の計測装置では周波数帯域が制限されるため，任意波形を送受信することはできない．
そのため，パルス的でない波形を用いることにによる開口合成像の変化について理解しておくこと
が有用である．その極端な場合として，単一周波数成分からなる連続波(continuous monochlomatic wave)
での画像化について検討する．

いま，原点にある点散乱体に向けて点$\fat{y}_i$から角周波数$\omega$で単位振幅の入射波を
送信したとする．このとき入射場は
\begin{equation}
	u^{in}(\fat{x},t)=e^{i\omega t-kr_i}, \ \ (r_i=\left| \fat{x}-\fat{y}_i\right|)
	\label{eqn:XXX_10}
\end{equation}
で与えられる．ここに，$k=\omega/c$は波数を表す．このとき，点散乱体から放射される散乱波は，
観測点$\fat{y}_j$において
\begin{equation}
	u^{sc}(\fat{y}_j,t)=
	u^{in}(\fat{o},t)e^{i k|\fat{y}_j|}
	=e^{i\omega t -k(R_i+R_j)}
	\label{eqn:XXX_11}
\end{equation}
と表される．ただし，$R_i=\left| y_i\right|$とする．これを観測波形$a_{ij}(t)$として
パルス-エコーモードで開口合成を行うとき，
画像化関数$I(\fat{x})$は
\begin{equation}
	I(\fat{x}) =
	\sum_{{\cal D}_M} 
		e^{i\omega t_{ii}(\fat{x}) -2kR_i)}
	=
	\sum_{{\cal D}_M} 
		e^{2ik(r_i-R_i)}
	\label{eqn:XXX_PSF_mono}
\end{equation}
で，この実部が単周波連続波を用いるときの点広がり関数を与える．
そこで，式(\ref{eqn:XXX_psf_cont})を観測点数$M=10$および20で計算すると，
図\ref{fig:XXX_PSF_mono}のような像が得られる．
\begin{figure}[h]
	\begin{center}
	\includegraphics[width=0.9\linewidth]{Figs/psf_cont.eps} 
	\end{center}
	\caption{全周方向からパルス-エコーモードで送受信したときの開口合成像.(a)$M=10$, (b)$M=20$で
	波長2の連続波を用いた場合.} 
	\label{fig:XXX_psf_cont}
\end{figure}
\begin{figure}[h]
	\begin{center}
	\includegraphics[width=0.6\linewidth]{Figs/psf_profile_cont.eps} 
	\end{center}
	\caption{$y=0$における開口合成像の断面図. 観測点数(a)$M=10$, (b)$M=20$で波長2の
	連続波を用いた場合.}
	\label{fig:XXX_psf_profile_cont}
\end{figure}
また，$y=0$における断面は図\ref{fig:ZZ_psf_profile_cont}のようである．
これらの図に示されるように，観測点数の少ない$M=10$のケースでは，
顕著なグレーティングローブが発生しているが，単周波数成分の波を用いた場合も，
全周方向からの計測であれば原点に明確なメインローブが現れることが分かる．
なお，メインローブ幅はおよそ半波長であることが読み取れ，このことは後で
述べるように理論的に示すことができる．
\subsection{結像位置のずれ}
送信点において，時刻0での入射波の位相が0でないとき，点拡がり関数は容易に劣化する．
図\ref{fig:XXX_psf_cont_delay}はその様子を見るため，
点拡がり関数の断面図を4つの位相遅れについて計算した結果である．
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}[h]
	\begin{center}
	\includegraphics[width=0.6\linewidth]{Figs/psf_cont_delay.eps} 
	\end{center}
	\caption{位相遅れのある入射波を用いたときの点拡がり関数.} 
	\label{fig:XXX_psf_cont_delay}
\end{figure}
\begin{figure}[h]
	\begin{center}
	\includegraphics[width=0.5\linewidth]{Figs/1D_prb.eps} 
	\end{center}
	\caption{反射壁の開口合成イメージング(1次元問題).} 
	\label{fig:XXX_1D_prb}
\end{figure}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{1次元問題}
結像位置のずれを補償する方法を1次元問題で考える．
今，$x=0$に送受信点をとり，$x=L(>0)$にある剛体壁からの反射波を観測したとする(図\ref{fig:XXX_1D_prb})．
入射場変位を
\begin{equation}
	u^{in}(x,t)=u\left(t-\frac{x}{c}\right)
	\label{eqn:XXX_uin_1D}
\end{equation}
と表し，$u(t)$は既知の入射波形，
$c$は位相速度とすれば，反射波$u^{r}(x,t)$は，$x=L$において$u^{in}+u^{r}=0$であることから
\begin{equation}
	u^{r}(x,t)=-u\left(t-\frac{x+2L}{c}\right)
	\label{eqn:XXX_ur_1D}
\end{equation}
と書ける．従って，$x=0$で反射波を観測して得られる波形は
\begin{equation}
	a_{11}(t)=u^{r}(0,t)=-u\left( t-\frac{2L}{c}\right)
	\label{eqn:XXX_12}
\end{equation}
と表され，これを使って得られる開口合成像は
\begin{equation}
	I(x)=
	a_{11}\left(t=\frac{2x}{c}\right)
	=
	-u\left(\frac{2}{c}(x-L)\right)
	\label{eqn:XXX_13}
\end{equation}
となる．もし，入射波振幅のピークが$t=t_d(>0)$であったとすれば，開口合成像$I(x)$のピーク位置は
$x=L+\frac{ct_d}{2}$となる．つまり，
剛体壁の内側に$\frac{ct_d}{2}$だけ入った位置にピークが現れ，
剛体壁表面の位置は正確に再構成されない．
このずれを補正して，正確な位置にピークが現れるようにするためには，3つの方法が考えられる．
\paragraph{時間軸原点の補正}
もっとも単純な方法は，計測波形を時間軸上であらかじめ$t_d$だけシフトし，
$a_{11}(t+t_d)$を用いて開口合成を行うことである．
これは，時間軸原点$t=0$を，送信時のトリガー信号によって決まる時刻でなく，
入射波形のピーク位置にとることを意味する．
なお，$t_d$には波形の立ち上がりからピークまでの時間に加え，
超音波探触子内の全面板や音響整合層とシューを通過するための時間も含まれる．
また，受信時にもシューや探触子内部を通過することによって遅延が生じる，
実際には，送信だけでなく受信についても考慮して時間軸の調整量$t_d$を与える必要がある．
\paragraph{参照波形を使ったデコンボリューション}
時間軸原点の補正によって正しい位置に像が得られるためには，入射波と反射波の波形が
変化しないことが前提となる．これは，1次元線形弾性問題の場合，あるいは，多次元問題で
は平面波が平面境界で反射される特殊なケースに限られる．一般には入射波形と反射波形は異なり，
両者の立ち上がり時間も異なることから，結像位置が状況に応じて変化することになる．
そこで，既知の反射壁からのエコーを計測し，これを参照波形として用いることで結像位置が
反射壁表面に来るよう調整する．反射壁の位置は$x=L_0$，反射壁の画像化を行う反射壁と同一とする．
このとき，反射波変位$u^{r}(x,t)$は，
\begin{equation}
	u^{r}(x,t)=Ru\left(t+\frac{x-2L_0}{c}\right)
	\label{eqn:XXX_14}
\end{equation}
と書ける．ただし$R$は反射係数で，剛体壁であれば$R=-1$である．
観測で得られる参照波形$a^{ref}(t)$は，
\begin{equation}
	a^{ref}(t)=u^{ref}(0,t)=
	Ru\left(t+\frac{2L_0}{c}\right)
	\label{eqn:XXX_15}
\end{equation}
である．ここで，時間に関するフーリエ変換対を
\begin{eqnarray}
	F(\omega)={\cal F}\{ a(t)\} &:=&  \int f(t)e^{-i\omega t} dt \\
	{\cal F}^{-1}\{ F(\omega)\} &:=&  \frac{1}{2\pi} \int F(\omega)e^{-i\omega t} dt 
\end{eqnarray}
で定義し，$a(t)$と$a^{ref}(t)$の時間に関するフーリエ変換をとる．
その結果を
\begin{equation}
	A(\omega)={\cal F}\{a_{11}(t)\}, \ \ 
	A^{ref}(\omega)={\cal F}\left\{ a^{ref}(t)\right\}
	\label{eqn:XXX_16}
\end{equation}
とすれば，これらは，${\cal F}\{ u(t)\}=U(\omega)$を用いて
\begin{equation}
	A(\omega) = RU(\omega) e^{2ik L},  \ \
	A^{ref}(\omega) = RU(\omega) e^{2ik L_0}, 
	\label{eqn:XXX_17}
\end{equation}
と表される．ただし$k=\omega/c$は波数を表す．
そこで，$A(\omega)/A^{ref}(\omega)$に，周波数領域での時間シフト$e^{2ikL_0}$をかけて
逆変換を行えば，
\begin{equation}
	\tilde a_{11}(t)= {\cal F}^{-1} \left\{ 
	\frac{A(\omega)}{A^{ref}(\omega)} e ^{2ik L_0}
	\right\}
	=\delta \left(t-\frac{2L}{c}\right)
	\label{eqn:XXX_at_dcnv}
\end{equation}
となる．観測波形$a_{11}(t)$の代わりに$\tilde a_{11}(t)$を用いて開口合成を行えば，
反射壁表面にピークをもつ画像が得られる．ただし,式(\ref{eqn:XXX_at_dcnv})のデコンボリューション
は，送受素子の周波数帯域制限と観測ノイズのために，全ての周波数で実際に$A/A^{ref}$
が得られることは無く，$\tilde a_{11}$は劣化したデルタ関数となる．
例えば，角周波数の帯域が$(-\omega_b,\, \omega_b)$に制限されるとき，
式\ref{eqn:XXX_at_dcnv}のフーリエ逆変換は
\begin{equation}
	\tilde a_{11}(t)= 
	\int_{-\omega_b}^{\omega_b} 
	e^{2ikL-i\omega t} d\omega 
	=\frac{\sin\left\{ \omega_b \left( t-\frac{2L}{c}\right)\right\}}{\pi \left(t-\frac{2L}{c}\right)}
	\label{eqn:XXX_18}
\end{equation}
とsinc関数で与えられ,観測誤差が無いと仮定した理想的な場合でも,デコンボリューションで得られる信号は
帯域幅$\omega_b$に応じた有限な幅を持つものになる.
\paragraph{時間反転法}
入射変位場$u^{in}(x,t)$と反射変位場$u^{r}(x,t)$がそれぞれ推定できたとする.
このとき,各々の時間に関するフーリ変換
\begin{equation}
	U^{in}(x,\omega)={\cal F} \{ u^{in}(x,t)\}, \ \ 
	U^{r}(x,\omega)={\cal F} \{ u^{r}(x,t)\}
	\label{eqn:XXX_19}
\end{equation}
を用い，角周波数$\omega$に関する次の積分を計算する．
\begin{equation}
	{\cal I }(x)=
	Re 
	\int 	
	U^{in}(x,\omega)\left( U^{r}(x,\omega)\right)^* d\omega
	\label{eqn:XXX_20}
\end{equation}
ここで，複素数値関数$f(x)$と$g(x)$の内積を
\begin{equation}
	\left< f,g\right>=\int f(x)g^*(x)dx
	\label{eqn:XXX_21}
\end{equation}
で，ノルムを
\begin{equation}
	\left\| f \right\|^2=\left<f,f\right> =\int |f(x)|^2dx
	\label{eqn:XXX_21}
\end{equation}
で定義する．ただし,$(\cdot)^*$は複素共役を表す．
$U^{in}$と$U^{r}$は
\begin{equation}
	U^{in}(x,\omega)=U(\omega)e^{ikx}, \ \ 
	U^{r}(x,\omega)=U(\omega)e^{-ik(x-2L)}
	\label{eqn:XXX_22}
\end{equation}
だから，${\cal I}(x)$は
\begin{equation}
	{\cal I}(x)
	=
	Re \left\{ 
	\left< U^{in},U^{r}\right>
	\right\}
	=
	\int 
	\left| U(\omega) \right|^2 
	R
	e^{2ik(x-L)}d\omega
	\label{eqn:XXX_pcnj}
\end{equation}
となる．また，シュワルツの不等式より
\begin{equation}
	Re \left\{ \left< U^{in}, U^{r}\right> \right\}
	\leq 
	\left| \left< U^{in},U^{r} \right> \right|
	\leq  \left\| U^{in}\right\| \left\| U^{r}\right\|
	=\left| R \right|
	\left\| U\right\|^2
	\label{eqn:XXX_23}
\end{equation}
で，${\cal I}(L)=R \left\| U\right\|^2$だから，式(\ref{eqn:XXX_pcnj})は$x=L$で最大値を取る．
従って${\cal I}=Re \left<U^{in},U^{r}\right>$を位置の関数として見ることで反射壁表面を画像化できる．
これは，以下の理由から開口合成法の一般化とみなすことができる．

${\cal I}$は，時間域での変位場を用いて
\begin{equation}
	{\cal I}(x)= 2\pi \left< u^{in}(x,t), u^{r}(x,t)\right>
	\label{eqn:XXX_I_ut}
\end{equation}
と書くことができる．ただし，式(\ref{eqn:XXX_I_ut})の内積は時間$t$に関する積分を意味する．
ここで，式(\ref{eqn:XXX_I_ut})の反射波変位を観測波形$a_{11}(t)$を用いて書けば
\begin{eqnarray}
	{\cal I}(x) &= & 
	2\pi \int u^{in}(x,t) a_{11}\left(t+\frac{x}{c}\right) dt
	\\
	&=&
	2\pi \int u^{in}\left(x,t-\frac{x}{c}\right) a_{11}\left(t\right) dt \\
	&=&
	2\pi \left< u^{in}\left(x,t-\frac{x}{c}\right), a_{11}(t) \right>
	\label{eqn:XXX_I_at}
\end{eqnarray}
とすることができる．
入射波波形$u(t)$を(実際とは異なるとしても)
理想的なパルスであるとして$u(t)=\delta(t)$とすれば，
式(\ref{eqn:XXX_I_at})は
\begin{equation}
	{\cal I}(x)=2\pi a_{11}\left(\frac{2x}{c}\right)
	\label{eqn:XXX_24}
\end{equation}
となり，$2\pi$の因子を除き，時間軸補正を行わない開口合成結果に一致する．
式(\ref{eqn:XXX_I_at})は，入射場$u^{in}(x,t)$と観測波形$a_{11}(t)$の相関
を使って像合成を行うもので，開口合成法はその特別なケースであることを意味する．
明らかに，時間軸を立ち上がり時間$t_d$だけ補正する場合は
$u^{in}(x,t)=\delta(t+t_d)$とみなすだけでよく，デコンボリューションによる
時間軸補正も以下のように同様な形式で表現することができる．

式(\ref{eqn:XXX_at_dcnv})を用いた開口合成像は
\begin{equation}
	I(x)=\left< \delta\left(t-\frac{2x}{c}\right), \tilde a_{11}(t) \right>
	\label{eqn:XXX_25}
\end{equation}
と表すことができる．右辺の内積を周波数領域で考えれば，
\begin{eqnarray}
	I(x) &=&
	\frac{1}{2\pi}\left< e^{2ikx}, \frac{A}{A^{ref}}e^{2ikL_0} \right> \\
	&=&
	\frac{1}{2\pi}\left< \frac{e^{2ik(x-L_0)}}{(A^{ref})^*}, A \right> 
	\label{eqn:XXX_26}
\end{eqnarray}
となる．これを再び時間領域の表現に戻せば，
\begin{equation}
	I(x)= \left< {\cal F}^{-1}\left\{ \frac{1}{(A^{ref})^*}\right\} *\delta \left( t-\frac{2(x-L_0)}{c}\right), a_{11}(t) \right>
	\label{eqn:XXX_Ix_dcnv}
\end{equation}
より，式(\ref{eqn:XXX_I_at})と同じ形式になる．
%%%%%
\subsubsection{多次元問題}
\paragraph{時間軸補正}
多次元問題では開口合成像は式(\ref{eqn:XXX_saft})で与えられる．
従って，時間軸の原点位置を補正したときの画像化関数は
\begin{equation}
	I(\fat{x})=\sum a_{ij}(t+t_d)w_{ij}
	\label{eqn:XXX_27}
\end{equation}
となる．なお，時間軸原点の補正量$t_d$は，送受信子の組み合わせによって
異なることが考えられるため，$t_d=t_d(i,j)$として，一般には観測波形毎に
異なるものとしておく．
\paragraph{デコンボリューション}
既知の点散乱体からの散乱波$\left\{ a_{ij}^{sc}(t)\right\}$
を参照波形として用いる．
$a_{ij}^{ref}(t)$のフーリエ変換を$A^{ref}_{ij}(\omega)$とすれば，
\begin{equation}
	\tilde a_{ij}(t) = {\cal F}^{-1} 
	\left\{
		\frac{A_{ij}}{A_{ij}^{ref}}e^{ik(L_i+L_j)}
	\right\}
	\label{eqn:XXX_28}
\end{equation}
を用いて開口合成を行うことで，正しい位置に結像する．
ただし，$L_i$は，点$\fat{x}_i$から参照波形の観測に用いた点散乱体までの距離を表す．
%
\paragraph{時間反転法}
位置$\fat{x}_j$の送信子からの入射波を$u^{in}(\fat{x},t;\fat{x}_j)$，そのときに
生じる散乱波を$u^{sc}(\fat{x},t;\fat{x}_j)$とする．
このとき，時間反転法における画像化関数を
\begin{eqnarray}
	{\cal I}(\fat{x})
		&=&
	2\pi
	\sum_{j}
	\left<
		u^{in}(\fat{x},t;\fat{x}_j), u^{sc}(\fat{x},t;\fat{x}_j)
	\right>
	\\
	&=&
	\sum_{j}
	\left<
		U^{in}(\fat{x},\omega;\fat{x}_j), U^{sc}(\fat{x},\omega;\fat{x}_j)
	\right>
	\label{eqn:XXX_Ix_trev}
\end{eqnarray}
とすれば，開口合成法における画像化関数$I(\fat{x})$が${\cal I}(\fat{x})$の特別な
ケースとして得られる．
なお，$U^{in}$と$U^{sc}$は，それぞれ$u^{in}$と$u^{sc}$の時間に関するフーリエ変換である．
$u^{in}$は散乱体を含まない場合の波動場であることから既知とみなすことができる．
一方$u^{sc}$は未知のため，時間反転法で推定する．
時間反転法で散乱場を推定する際，観測波形を用いる．
推定に用いる情報は多い方がよいため，全ての受信点$\fat{x}_i$で得られた観測波形を用いる．
このとき解くべき初期値問題は
\begin{equation}
	\nabla ^2 u^{sc}(\fat{x},\tau;\fat{x}_j)-c^{-2}\ddot{u}^{sc}(\fat{x},\tau; \fat{x}_j)=0
	\label{eqn:XXX_29}
\end{equation}
\begin{equation}
	u^{sc}(\fat{x},\tau=0;\fat{x}_j)=0, \ \ 
	\dot{u}^{sc}(\fat{x},\tau=0;\fat{x}_j)=0
	\label{eqn:XXX_30}
\end{equation}
\begin{equation}
	u^{sc}(\fat{x}_i,\tau;\fat{x}_j)=a_{ij}(T-\tau), \ \ (i \in {\cal M})
	\label{eqn:XXX_31}
\end{equation}
である．点源からの入射場は
\begin{equation}
	u^{in}(\fat{x},t;\fat{x}_j)=\frac{1}{4\pi r_j}u\left(t-\frac{r_j}{c}\right)
	\label{eqn:XXX_32}
\end{equation}
で，散乱場は
\begin{equation}
	u^{sc}(\fat{x},t;\fat{x}_j)=\sum_{\fat{x}_i}
	\frac{1}{4\pi r_i}a_{ij}\left(T-\left(\tau-\frac{r_i}{c}\right)\right), \ \ (\tau=T-t)
	\label{eqn:XXX_33}
\end{equation}
となるので，これらの結果を用いて$\cal I$を評価することができる．
さらに，入射波形を理想的なパルスとみなし，
\begin{equation}
	u(t)=\delta(t)
	\label{eqn:XXX_34}
\end{equation}
とすれば，
\begin{equation}
	{\cal I}(\fat{x})
	=
	\sum_{i,j} \frac{1}{8\pi r_ir_j} a_{ij} \left(\frac{r_i+r_j}{c}\right)
	\label{eqn:XXX_35}
\end{equation}
が得られ，重みを
\begin{equation}
	w_{ij}(\fat{x})=\frac{1}{8\pi r_ir_j} 
	\label{eqn:XXX_36}
\end{equation}
としたときの開口合成画像が得られる．
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\input{adj.tex}
\input{poffis.tex}
\end{document}








%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{線形化逆散乱法}
\subsection{散乱場の積分表現}
周波数領域におけるスカラー波の散乱問題を考える．
波動場を$u(\fat{x},\omega)$とし，特に必要の無い限り角周波数$\omega$は省略する．
$u(\fat{x})$は，ヘルムホルツ方程式を満足する．
\begin{equation}
	\nabla^2 u(\fat{x}) + k^2 u(\fat{x}) =0, \ \ (\fat{x} \notin \bar{D})
	\label{eqn:}
\end{equation}
ここに，$k=\omega/c$は一定の波数を表す．
はじめに，無限領域中に置かれた散乱体$D$は，境界$\partial D$上でディリクレ条件
\begin{equation}
	u(\fat{x}) = 0, \ \ \fat{x}\in \partial D
	\label{eqn:}
\end{equation}
あるいは，ノイマン条件:
\begin{equation}
	\frac{\partial u}{\partial n} = 0 ,\ \ \fat{x}\in \partial D
	\label{eqn:}
\end{equation}
を満足する場合について考える．
散乱場を$u^{\rm sc}(\fat{x})$，入射波$u^{in}(\fat{x})$とすると，全波動場は
\begin{equation}
	u(\fat{x})=u^{in}(\fat{x})+ u^{\rm sc}(\fat{x})
	\label{eqn:}
\end{equation}
と表される．散乱場は放射条件を満足するものとすれば，
$u^{\rm sc}(\fat{x})$は次のように積分表現することができる．
\begin{equation}
	u^{\rm sc}(\fat{y}) = \int _{\partial D} 
	\left\{
		G(\fat{x},\fat{y})t(\fat{x})
	-
		H(\fat{x},\fat{y})u(\fat{x})
	\right\} dS_x
	\label{eqn:}
\end{equation}
ここで，$G(\fat{x},\fat{y})$は
\begin{equation}
	\nabla^2 G(\fat{x},\fat{y}) + k^2 G(\fat{x},\fat{y}) =-\delta (\fat{x}-\fat{y} )
	\label{eqn:}
\end{equation}
を満足する無限領域のおけるグリーン関数で，
\begin{equation}
	G(\fat{x},\fat{y}) =\frac{e^{ikr}}{4\pi r}, \ \ r=\left| \fat{x}-\fat{y} \right|
	\label{eqn:Green}
\end{equation}
で与えられる．また，
\begin{equation}
	H(\fat{x},\fat{y}) = \frac{\partial G(\fat{x},\fat{y})}{\partial n(\fat{x})}, \ \ 
	t(\fat{x}) =\frac{\partial u(\fat{x})}{\partial n(\fat{x})}
	\label{eqn:}
\end{equation}
とした．
ここで，$y=\left|\fat{y}\right|\gg \left| \fat{x} \right|$のとき，幾何光学近似
\begin{equation}
	r\sim  y  -\hat{\fat{y}}\cdot \fat{x}, \ \ (y\rightarrow \infty)
	\label{eqn:para}
\end{equation}
を用いると，散乱場の積分表現は，ディリクレ問題，ノイマン問題，それぞれの場合について
\begin{equation}
	u^{\rm sc}(\fat{y}) \sim \frac{e^{iky}}{4\pi y} U(\hat{\fat{y}};s)  
	\label{eqn:}
\end{equation}
\begin{equation}
	U(\hat{\fat{y}};s)  = \int _{\partial D} t(\fat{x};s)e^{-ik\hat{\fat{y}}\cdot \fat{x}} dS_x
	, \ \ ( {\rm Dirichlet})
	\label{eqn:}
\end{equation}
\begin{equation}
	U(\hat{\fat{y}};s)  =-\int _{\partial D} u(\fat{x};s)e^{-ik\hat{\fat{y}}\cdot \fat{x}} dS_x
	, \ \ ({\rm Neumann})
	\label{eqn:}
\end{equation}
なお，$;$に続く$s$は入射波を指定するパラメータを表し，このように表記すること
入射波に依存した量であることを必要あ場合には明示する．
ここで，任意の$D$と場の量$f(\fat{x})$に対して次のように作用する特異関数$\gamma_D(\fat{x})$
\begin{equation}
	\int \gamma_D(\fat{x})f(\fat{x})d^3\fat{x} =\int _{\partial D} f(\fat{x}) dS
	\label{eqn:}
\end{equation}
を導入する．これを用いると，散乱振幅を
\begin{equation}
	U(\hat{\fat{y}};s)  = \int \gamma_D(\fat{x})t(\fat{x};s)e^{-ik\hat{\fat{y}}\cdot \fat{x}} dS_x
	, \ \ ( {\rm Dirichlet})
	\label{eqn:}
\end{equation}
\begin{equation}
	U(\hat{\fat{y}};s)  =-\int \gamma_D(\fat{x})u(\fat{x};s)e^{-ik\hat{\fat{y}}\cdot \fat{x}} dS_x
	, \ \ ({\rm Neumann})
	\label{eqn:}
\end{equation}
と，フーリエ積分の形式で表すことができる．

続いて，領域$D$を介在物が占める場合について考える．
ここで，介在物の外部で波数は$k_0$で一定とし，内部では一般に$k_0$とは異なる
波数となるとする．
そこで，波数を位置の関数として$k(\fat{x})$とすれば，支配方程式であるHelmholtz方程式は
\begin{equation}
	\nabla^2 u(\fat{x},\omega) + k^2(\fat{x}) u(\fat{x},\omega) =0
	\label{eqn:Hlmhlz2}
\end{equation}
となる．ここで，
\begin{equation}
	n_r(\fat{x}) =\frac{k}{k_0}
	\label{eqn:}
\end{equation}
\begin{equation}
	V(\fat{x})=n_r^2(\fat{x}-1)
	\label{eqn:}
\end{equation}
とおけば，
\begin{equation}
	k^2=k_0^2 + k_0^2 V(\fat{x})
	\label{eqn:}
\end{equation}
より，式(\ref{eqn:XXX_Hlmhlz2})は
\begin{equation}
	\nabla^2 u(\fat{x},\omega) + k_0(\fat{x}) u(\fat{x},\omega) = -k_0^2 V(\fat{x})u(\fat{x})
	\label{eqn:Hlmhlz3}
\end{equation}
と，形式上，非斉次のHelmholtz方程式の形に書き直すことができる．
従って，右辺の非斉次項を物体力項として扱えば，散乱場を次のように積分表示することができる．
\begin{equation}
	u^{\rm sc}(\fat{y})=u(\fat{y})-u^{in}(\fat{y}) = k_0^2\int G_0(\fat{x},\fat{y})V(\fat{x})u(\fat{x}) d^3\fat{x}
	\label{eqn:LS}
\end{equation}
ここで$G_0(\fat{x},\fat{y})$は波数$k_0$をもつ均質な無限媒体に対するグリーン関数で，
式(\ref{eqn:XXX_Green})において$k=k_0$としたものである．
式(\ref{eqn:XXX_LS})はLippman-Schwinger方程式，$V(\fat{x})$は散乱ポテンシャルと呼ばれる．
散乱ポテンシャルは$D$を台に持つため，$V(\fat{x})$を求めることができれば，
散乱体形状が再構成される．
最後に，$G_0(\fat{x},\fat{y})$に幾何光学近似(\ref{eqn:XXX_para})を用いれば，
式(\ref{eqn:XXX_LS})は
\begin{equation}
	u^{\rm sc}(\fat{y})
	=
	\frac{e^{ik_0y}}{4\pi y}
	\int
	k_0^2 V(\fat{x})u(\fat{x}) e^{-ik\hat{\fat{y}}\cdot \fat{x}}d^3\fat{x}
	\label{eqn:}
\end{equation}
となるので，
\begin{equation}
	U(\hat{\fat{y}},s)
	=
	\int
	k_0^2 V(\fat{x})u(\fat{x};s) e^{-ik\hat{\fat{y}}\cdot \fat{x}}d^3\fat{x}
	\label{eqn:U_vol}
\end{equation}
とすることで，散乱場を表面散乱体の場合と同じ形式に表すことができる．
%
\subsection{線形化逆散乱解析}
はじめに，式(\ref{eqn:XXX_LS})に基づき，散乱ポテンシャル$V(\fat{x}$を推定することで
介在物の形状を再構成する方法を示す．いま，散乱体$D$に平面波:
\begin{equation}
	u^{in}(\fat{x})= e^{ik_0\fat{p}\cdot\fat{x}}
	\label{eqn:}
\end{equation}
を入射したときの$U(\hat{\fat{y}};s)$を
\begin{equation}
	u^{\infty}(\hat{\fat{y}};\fat{p})=U(\hat{\fat{y}};\fat{p})
	\label{eqn:}
\end{equation}
と表し，これを散乱振幅と呼ぶ．
ここで，$\fat{p}$は入射平面波の伝播方向を表す単位ベクトルを意味する．
このとき，式(\ref{eqn:U_vol})にボルン近似を用い，$u(\fat{x})\simeq u^{in}(\fat{x})$
とすれば，散乱振幅は
\begin{equation}
	u^{\infty}(\hat{\fat{y}},\fat{p})
	=
	\int
	k_0^2 V(\fat{x}) e^{-ik(\hat{\fat{y}}-\fat{p} )\cdot \fat{x}}d^3\fat{x}
	\label{eqn:U_Born}
\end{equation}
と書ける．そこで，散乱ポテンシャル$V(\fat{x})$のフーリエ変換を
\begin{equation}
	\tilde V(\fat{k}) = \int V(\fat{x}) e^{i\fat{k}\cdot \fat{x}} d^3\fat{x}
	\label{eqn:Vk}
\end{equation}
とすれば，式(\ref{eqn:U_Born})は
\begin{equation}
	u^{\infty}(\hat{\fat{y}},\fat{p}) =k_0^2 \tilde V (
	k(\hat{\fat{y}}-\fat{p} )
	)
	\label{eqn:}
\end{equation}
となることから，散乱振幅が散乱ポテンシャルの波数ベクトル$k(\hat{\fat{y}}-\fat{x})$
でのスペクトル成分であることが分かる．
従って，送受信条件や周波数帯域を適切に設定し，十分な範囲と密度で波数スペクトル成分を
得ることができれば，逆フーリエ変換
\begin{equation}
	V(\fat{x}) =\frac{1}{(2\pi)^3} \int k_0^{-2} u^{\infty}(\hat{\fat{y}};\fat{p}) 
	e^{i\fat{k}\cdot \fat{x}}d^3\fat{k}
	\label{eqn:Vx}
\end{equation}
によって散乱ポテンシャル$V(\fat{x})$を再構成できる．
ここに，式(\ref{eqn:Vx})における波数ベクトル$\fat{k}$は
\begin{equation}
	\fat{k}=k(\hat{\fat{y}}-\fat{p})
	\label{eqn:}
\end{equation}
だから，フーリエ積分の評価に用いることのできる波数ベクトル成分は，角周波数$\omega$,
観測方向$\hat{\fat{y}}$，入射方向$\fat{p}$に依って決まる．
いま，$\omega$と$\fat{p}$を固定し，観測方向だけを自由に取ることができる場合を考えると，
$\fat{k}$は波数空間で，図\ref{fig:Evald}に実線で示したような半径$k$球を描き，
これをEvald球と呼ぶ．つまり，観測方向だけを変化させて観測した場合，
散乱ポテンシャルのEvald球状の成分だけしか得られない．一方，観測方向$\hat{\fat{y}}$に加え，
入射方向$\fat{p}$も任意に選べる場合，Evald球は原点を中心として半径$2k$の球表面と内部を履く．
このような波数空間の球領域はEvald limitting sphere(Evald限界球)と呼ばれる．
全ての送受信方向で観測を行うことができれば，Evald限界球内部の
波数成分全ての情報が得られるため，波数$k$十分に大きければ，単一の波数成分
のデータだけで，散乱ポテンシャルの十分な情報が得られる．
しかしながら，例えば超音波探傷試験では，送受信方向は制約が厳しく，
ごく限られた方向からの送受信しか行うことができないために，Evald限界球内の
一部のデータしか得られない．
一方で，送受信することのできる周波数帯域はパルスやチャープ波を用いることで
ある程度広くとることができる．このときには，波数$k$が$k\in \left(k_{min},k_{max} \right)$
の範囲にあるEvald球の一部が掃く領域が単一周波数(monochromatic)での
検査に比べて広くとることができ，散乱ポテンシャルに関するより多くの情報を得ることができる．
\\

ここで,散乱振幅を
\begin{equation}
	u^{\infty}(\hat{\fat{y}};\fat{p})=4\pi ye^{-iky} u^{sc}(\fat{y})
	\label{eqn:}
\end{equation}
として，観測波形データ$u^{sc}$を用いて式(\ref{eqn:Vx})を書き直すと
\begin{equation}
	V(\fat{x}) =\frac{1}{2\pi^2} \int k_0^{-2} yu^{sc}(\fat{y})
	e^{i\fat{k}\cdot \fat{x}-iky}d^3\fat{k}, 
	\ \ (\fat{k}=k(\hat{\fat{y}}-\fat{p}))
	\label{eqn:Vx_usc}
\end{equation}
となる．この再構成式がどのような操作を意味するかは，次節で述べるように，
周波数$\omega$に関する積分を行い時間領域における再構成式に直すことで
明らかになる．
\begin{figure}[h]
	\begin{center}
	\includegraphics[width=0.5\linewidth]{Figs/setup.eps} 
	\end{center}
	\caption{無限領域におけるスカラー波の散乱問題.} 
	\label{fig:}
\end{figure}
\begin{figure}[h]
	\begin{center}
	\includegraphics[width=0.6\linewidth]{Figs/Evald.eps} 
	\end{center}
	\caption{波数ベクトル空間におけるEvaldおよびEvald limitting sphere.} 
	\label{fig:Evald}
\end{figure}
\subsection{時間領域における再構成式}
式(\ref{eqn:Vx})の積分を評価するにあたり，微小体積要素$d^3\fat{k}$を 
$\fat{p}$，$\hat{\fat{y}}$, $k$を用いて表す必要がある．
%波数ベクトル$\fat{k}$は入射波の送信方向$\fat{p}$，散乱波の観測方向$\hat{\fat{y}}$と
%角周波数$\omega$に依存する．従って，波数ベクトルに関するフーリエ変換を観測波形を
%使って評価する際には，観測条件に応じた積分変数を取る必要がある．
ここでは，次のような二つのケースについて考える．
%では微小体積要素$d^3\fat{k}$を書き下すことができる．
\begin{enumerate}
\item
	送信(受信)方向$\fat{p}(\hat{\fat{y}})$を固定し，
	受信(送信)方向$\hat{\fat{y}}(\fat{p})$を変化させる場合\\

	観測方向を表すベクトルを次のように球座標を使って表す．
	\begin{equation}
		\hat{\fat{y}}=(\sin\theta\cos\phi,\sin\theta\sin\phi, \cos\theta)
		\label{eqn:}
	\end{equation}
	このとき，微小体積要素はヤコビ行列式を計算すれば
	\begin{equation}
		d^3\fat{k}=k^2\sin\theta (1-\hat{\fat{y}}\cdot\fat{p})dkd\theta d\phi
		\label{eqn:}
	\end{equation}
	となることが示される．
	ここで,
	\begin{equation}
		\cos\delta=\hat{\fat{y}}\cdot\fat{p}
		\label{eqn:}
	\end{equation}
	とおけば,
	\begin{equation}
		d^3\fat{k}=4k^2\sin\theta \sin^2 \frac{\delta}{2} dkd\theta d\phi
		\label{eqn:}
	\end{equation}
\item
	送信方向と受信方向が成す角度を一定に保ち，送受方向を同時に変化させる場合\\

	単位ベクトル:
	\begin{equation}
		\hat{\fat{k}}=\frac{\hat{\fat{y}}-\fat{p}}
		{\left| \fat{y}-\fat{p} \right| }
		\label{eqn:}
	\end{equation}
	を用いれば,波数ベクトル$\fat{k}$は
	\begin{equation}
		\fat{k}= k\left| \hat{\fat{y}}-\fat{p} \right| \hat{\fat{k}} 
		\label{eqn:}
	\end{equation}
	と書くことができ,$\hat{\fat{y}} \cdot \fat{p}= \cos \delta$とおけば,	
	\begin{equation}
		\fat{k}= 2k \sin \frac{\delta}{2}\hat{\fat{k}} 
	\label{eqn:}
	\end{equation}
	と表すことができる.$\delta$は一定だから,$\hat{\fat{k}}$を
	\begin{equation}
		\hat{\fat{k}}=(\sin\theta\cos\phi,\sin\theta\sin\phi, \cos\theta)
		\label{eqn:}
	\end{equation}
	と球座標を使って表せば,微小体積要素を
	\begin{equation}
		d^3\fat{k}=2\sin\frac{\delta}{2} 
		k^2 \sin\theta dkd\theta d\phi
		\label{eqn:}
	\end{equation}
\end{enumerate}
\begin{figure}[h]
	\begin{center}
	\includegraphics[width=0.7\linewidth]{Figs/pulse_echo.eps} 
	\end{center}
	\caption{送受信パターン.} 
	\label{fig:}
\end{figure}
パルスエコー法(一探触子法)による計測は後者の特別な場合に相当する．
以上より，$d^3\fat{k}$は
\begin{equation}
	d^3\fat{k}=k^2\hat{J}(\theta,\phi) dkd\theta d\phi
	\label{eqn:}
\end{equation}
と表すことができる．
これを式(\ref{eqn:Vx_usc})に代入することにより次の再構成式が得られる．
\begin{equation}
	V(\fat{x}) =\frac{1}{2\pi^2} \int yu^{sc}(\fat{y})
	e^{i\fat{k}\cdot \fat{x}-iky}
	\hat{J}(\theta,\phi) dkd\theta d\phi
	\label{eqn:}
\end{equation}

ここで，送信点を$\fat{z}$とし，
\begin{equation}
	u^{in}(\fat{x})= F(\omega) e^{ik_0\fat{p}\cdot(\fat{x}-\fat{z})}
	\label{eqn:}
\end{equation}
のような周波数成分$F(\omega)$をもつ平面波を入射する場合について考える．
このとき，散乱場は
\begin{equation}
	u^{\rm sc}(\fat{y})= \frac{e^{ik_0(y-\fat{p}\cdot \fat{z})}}{4\pi y }F(\omega)U(\hat{\fat{y}};\fat{p}) 
	\label{eqn:}
\end{equation}
と書くことができる．よって，散乱ポテンシャルは観測データとして得られる
散乱場を使って次のように表される．
\begin{equation}
	V(\fat{x}) =\frac{1}{2\pi^2} \int \frac{u^{sc}(\fat{y})}{F(\omega)}
	e^{i\fat{k}\cdot \fat{x}-iky+ik\fat{p}\cdot\fat{z}}
	\hat{J} dkd\phi d\theta	
	\label{eqn:}
\end{equation}
さらに，$\fat{k}=k(\hat{\fat{y}}-\fat{p})$を代入し，$k=\omega/c$を用いれば，
\begin{equation}
	V(\fat{x}) =\frac{1}{2\pi^2c} \int \frac{yu^{sc}(\fat{y})}{F(\omega)}
	e^{-ik_0(y-\hat{\fat{y}}\cdot\fat{x}+\fat{p}\cdot(\fat{x}-\fat{z})) }
	\hat{J} d\omega d\phi d\theta	
	\label{eqn:}
\end{equation}
を得る．
ここで，角周波数$\omega$に関するフーリエ変換
\begin{equation}
	a(\fat{y},\fat{z},t):=\frac{1}{2\pi} \int \frac{u^{sc}(\fat{y})}{F(\omega)}e^{-i\omega t}d\omega
	\label{eqn:}
\end{equation}
で得られる時間波形を用いると，散乱ポテンシャルを
\begin{equation}
	V(\fat{x}) =\frac{1}{2\pi^2c} \int a\left(\fat{y}, \fat{z}, t_{in}+t_{sc} \right) y \hat{J} d\theta d\phi
	\label{eqn:Vx_time}
\end{equation}
と表される．ただし，$t_{in},t_{sc}$はそれぞれ
\begin{equation}
	t_{in}=\frac{\fat{p}\cdot \left( \fat{x}-\fat{z}\right)}{c}, \ \ 
	t_{sc}=
	\frac{ y-\hat{\fat{y}}\cdot \fat{x} }{c} \simeq 
	\frac{\left|\fat{y}-\fat{x}\right|}{c} 
	\label{eqn:}
\end{equation}
で，入射波と散乱波の伝播時間を意味する．
式(\ref{eqn:Vx_time})を離散的な$\fat{y},\fat{z}$について評価する場合，
積分は次のような和とみなすことができ，これは，発見的に導かれた開口合成法の
形式と一致する．
\begin{equation}
	V(\fat{x}) = 
	\frac{1}{2\pi^2c} 
	\sum_{\fat{y},\fat{z}} 
	a\left(\fat{y}, \fat{z}, t_{in}+t_{sc} \right) y \hat{J} \Delta \theta \Delta \phi
	\label{eqn:}
\end{equation}

